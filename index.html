<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guestbbook | Luxury STR Digital Guidebooks</title>
    <!-- CSS & Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,opsz,wght@1,6..96,400..900&family=Inter:wght@300;400;500;700;900&display=swap');
        
        :root { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; color: #18181b; margin: 0; overflow-x: hidden; text-align: left; }
        .font-serif { font-family: 'Bodoni Moda', serif; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #d1d5db; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes fade-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-up { animation: fade-up 0.6s ease-out forwards; }
        
        .chat-bubble { border-radius: 1.5rem; padding: 1rem; max-width: 85%; font-size: 0.875rem; line-height: 1.25rem; margin-bottom: 0.5rem; }
        .bubble-guest { background-color: #f4f4f5; color: #18181b; align-self: flex-end; border-bottom-right-radius: 0.25rem; }
        .bubble-ai { background-color: #18181b; color: white; align-self: flex-start; border-bottom-left-radius: 0.25rem; }

        input[type="color"] { -webkit-appearance: none; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; padding: 0; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 50%; }

        .auth-transition { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Image Uploader Utilities */
        .image-grid { display: grid; gap: 1rem; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        
        const apiKey = ""; // Gemini API Key Integration
        const LOCAL_STORAGE_KEY = 'guestbbook_properties_v1';

        const INITIAL_GUEST_BOOKS = [
            {
                id: '1',
                propertyName: 'The Glass Pavilion',
                address: '88 High Ridge Road, Aspen, CO',
                accentColor: '#18181b',
                images: [
                    { id: 'img1', url: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=800&q=80', isCover: true },
                    { id: 'img2', url: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=800&q=80', isCover: false }
                ],
                welcomeMessage: 'Experience alpine luxury at its finest. We’ve designed this space to be your sanctuary in the mountains.',
                checkInTime: '3:00 PM',
                checkOutTime: '10:00 AM',
                parkingInfo: 'Heated driveway and two-car garage access with remote inside.',
                wifiName: 'Pavilion_Guest_5G',
                wifiPassword: 'aspen-snow-luxury',
                entryCode: '0922*',
                checkInInstructions: 'Drive up the main driveway and park in the designated guest spots. The lockbox is located on the wooden post near the front door.',
                checkOutTasks: ['Start the dishwasher', 'Take trash to the outside bins', 'Lock all doors and windows'],
                houseRules: ['Strictly no smoking', 'Quiet hours 10pm-8am', 'Remove shoes at entry'],
                hostName: 'Sarah & James',
                hostBio: 'We are avid travelers and architecture enthusiasts. We designed this space to offer a tranquil escape while keeping you close to the vibrant local culture. We hope you love it here as much as we do!',
                recommendations: [
                    { id: 'r1', name: 'Matsuhisa', address: '303 E Main St, Aspen, CO', type: 'Food', description: 'Exceptional sushi and Japanese-Peruvian fusion.', distance: '0.4' },
                    { id: 'r2', name: 'City Market', address: '711 E Cooper Ave, Aspen, CO', type: 'Grocery', description: 'Premium provisions and organic local produce.', distance: '0.6' }
                ]
            }
        ];

        const DEMO_GUEST_BOOKS = [
            {
                id: 'demo-1',
                propertyName: 'The Manhattan Penthouse',
                description: 'A sleek, high-altitude sanctuary with skyline views.',
                address: '111 W 57th St, New York, NY',
                accentColor: '#1a1a1a',
                images: [{ id: 'd1', url: 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?auto=format&fit=crop&w=800&q=80', isCover: true }],
                welcomeMessage: 'Welcome to the top of the world. Enjoy the unparalleled views and absolute privacy of this exclusive penthouse. Our dedicated concierge is available 24/7.',
                checkInTime: '4:00 PM', checkOutTime: '11:00 AM',
                wifiName: 'Penthouse_Elite_5G', wifiPassword: 'skyline-luxury', entryCode: '4821*',
                checkInInstructions: 'Enter through the private garage on 58th street. Use the secure elevator code provided on your arrival day to access the penthouse level directly.',
                checkOutTasks: ['Leave key fobs on the kitchen island', 'Turn off all lights'],
                houseRules: ['No smoking indoors', 'No parties or events', 'Please respect quiet hours after 10 PM'],
                hostName: 'Eleanor',
                hostBio: 'A longtime New Yorker with a passion for art and design. I love sharing this incredible skyline view with guests from around the world.',
                recommendations: [
                    { id: 'r1', name: 'Le Bernardin', type: 'Food', description: 'World-renowned seafood just blocks away.', distance: '0.3' },
                    { id: 'r2', name: 'Whole Foods Columbus Circle', type: 'Grocery', description: 'Premium organic groceries.', distance: '0.4' }
                ]
            },
            {
                id: 'demo-2',
                propertyName: 'Malibu Ocean Villa',
                description: 'A serene beachfront escape with panoramic ocean vistas.',
                address: '21000 Pacific Coast Hwy, Malibu, CA',
                accentColor: '#0c4a6e',
                images: [{ id: 'd2', url: 'https://images.unsplash.com/photo-1499793983690-e29da59ef1c2?auto=format&fit=crop&w=800&q=80', isCover: true }],
                welcomeMessage: 'Your private slice of the Pacific. Let the sound of the waves wash away your worries. Please help us protect the marine environment during your stay.',
                checkInTime: '3:00 PM', checkOutTime: '10:00 AM',
                wifiName: 'OceanVilla_Guest', wifiPassword: 'waves-sun-sand', entryCode: '1199*',
                checkInInstructions: 'Park in the designated spots on the driveway. The front gate code is your entry code. The front door has a smart lock pre-programmed for your stay.',
                checkOutTasks: ['Close all ocean-facing windows', 'Cover outdoor furniture', 'Empty the fridge of perishables'],
                houseRules: ['Rinse sand off at outdoor shower', 'No glass by the pool', 'Keep patio doors closed at night'],
                hostName: 'Marcus',
                hostBio: 'I grew up surfing these beaches and built this villa to capture the true essence of Malibu living. Always happy to share my favorite hidden surf spots.',
                recommendations: [
                    { id: 'r1', name: 'Nobu Malibu', type: 'Food', description: 'Exquisite sushi with an ocean view.', distance: '1.2' },
                    { id: 'r2', name: 'Vintage Grocers', type: 'Grocery', description: 'Local gourmet market.', distance: '2.5' }
                ]
            },
            {
                id: 'demo-3',
                propertyName: 'Aspen Modern Cabin',
                description: 'Contemporary alpine design meets cozy mountain living.',
                address: '400 E Dean St, Aspen, CO',
                accentColor: '#292524',
                images: [{ id: 'd3', url: 'https://images.unsplash.com/photo-1510798831971-661eb04b3739?auto=format&fit=crop&w=800&q=80', isCover: true }],
                welcomeMessage: 'Welcome to your alpine retreat. Enjoy the slopes and unwind by the fire. We’ve stocked the pantry with local hot cocoa blends.',
                checkInTime: '4:00 PM', checkOutTime: '10:00 AM',
                wifiName: 'Aspen_Cabin_Fast', wifiPassword: 'powder-snow-ski', entryCode: '7734*',
                checkInInstructions: 'The driveway can be steep; 4WD is recommended in winter months. The main key is located in the lockbox attached to the front porch railing.',
                checkOutTasks: ['Start the dishwasher', 'Turn the thermostat down to 60°F', 'Lock all deadbolts'],
                houseRules: ['Remove ski boots in mudroom', 'Do not leave fires unattended', 'Trash in bear-proof bins only'],
                hostName: 'The Miller Family',
                hostBio: 'We love hitting the slopes and curling up by the fire. We hope our cabin provides you with the perfect basecamp for your mountain adventures.',
                recommendations: [
                    { id: 'r1', name: 'Matsuhisa Aspen', type: 'Food', description: 'Premium Japanese cuisine.', distance: '0.5' },
                    { id: 'r2', name: 'City Market', type: 'Grocery', description: 'Everything you need for your stay.', distance: '0.8' }
                ]
            },
            {
                id: 'demo-4',
                propertyName: 'Austin Boutique Loft',
                description: 'Industrial chic aesthetics in the heart of downtown.',
                address: '200 Congress Ave, Austin, TX',
                accentColor: '#3f3f46',
                images: [{ id: 'd4', url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=800&q=80', isCover: true }],
                welcomeMessage: 'Experience the vibrant energy of Austin from your centrally located, stylish loft. Enjoy the vintage record collection in the living area.',
                checkInTime: '3:00 PM', checkOutTime: '11:00 AM',
                wifiName: 'Loft_ATX_5G', wifiPassword: 'keep-austin-weird', entryCode: '0021*',
                checkInInstructions: 'The building requires fob access. Call dial box 042 and we will buzz you in. Your fobs and physical keys will be waiting on the kitchen counter.',
                checkOutTasks: ['Take out trash to the chute down the hall', 'Leave used towels in the bathtub'],
                houseRules: ['No smoking', 'Quiet hours 11 PM to 7 AM', 'Pets require prior approval'],
                hostName: 'Chloe',
                hostBio: 'Musician and local foodie. I curated this loft to feel like a creative haven right in the center of the live music capital of the world.',
                recommendations: [
                    { id: 'r1', name: 'Franklin Barbecue', type: 'Food', description: 'Legendary brisket, get there early!', distance: '1.5' },
                    { id: 'r2', name: 'Royal Blue Grocery', type: 'Grocery', description: 'Compact urban grocery.', distance: '0.2' }
                ]
            }
        ];

        const callGemini = async (prompt, systemInstruction = "") => {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: systemInstruction ? { parts: [{ text: systemInstruction }] } : undefined
            };
            try {
                const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Concierge offline.";
            } catch (err) { return "Error connecting."; }
        };

        const Icon = ({ name, size = 20, className = "" }) => {
            const spanRef = useRef(null);

            useEffect(() => {
                if (spanRef.current && window.lucide) {
                    spanRef.current.innerHTML = ''; // Clear existing
                    const iconName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                    const iconData = window.lucide.icons[iconName];
                    
                    if (iconData) {
                        const svg = window.lucide.createElement(iconData);
                        svg.setAttribute('width', size);
                        svg.setAttribute('height', size);
                        svg.setAttribute('class', `lucide lucide-${name} ${className}`);
                        spanRef.current.appendChild(svg);
                    }
                }
            }, [name, size, className]);

            return <span ref={spanRef} className={`inline-flex items-center justify-center align-middle ${className}`} style={{ width: size, height: size }} />;
        };

        const BrandLogo = ({ sizeClass = "w-10 h-10 md:w-12 md:h-12" }) => {
            const [imgError, setImgError] = useState(false);
            const LOGO_URL = "https://i.postimg.cc/0jrh7j9f/hf-20260219-220739-0f0094b0-743f-4b27-ba26-5f34aad46fd7.png"; 

            if (imgError) {
                return (
                    <div className={`${sizeClass} bg-zinc-900 text-white rounded-full flex items-center justify-center font-serif italic text-2xl md:text-3xl shadow-xl leading-none shrink-0`}>
                        g
                    </div>
                );
            }
            return (
                <img 
                    src={LOGO_URL} 
                    alt="Guestbbook Logo" 
                    className={`${sizeClass} rounded-full object-cover shadow-xl shrink-0`} 
                    onError={() => setImgError(true)} 
                />
            );
        };

        const SidebarItem = ({ iconName, label, active, onClick }) => (
            <button onClick={onClick} className={`w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-300 ${active ? 'bg-zinc-900 text-white shadow-xl' : 'text-zinc-500 hover:bg-zinc-50'}`}>
                <Icon name={iconName} size={18} />
                <span className="font-semibold text-sm truncate">{label}</span>
            </button>
        );

        // Utility function to resize and compress images for localStorage
        const processImageFile = (file) => {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const MAX_WIDTH = 1000;
                        let width = img.width;
                        let height = img.height;
                        if (width > MAX_WIDTH) {
                            height = Math.round((height * MAX_WIDTH) / width);
                            width = MAX_WIDTH;
                        }
                        const canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        // Compress as WebP for efficiency in localStorage
                        resolve(canvas.toDataURL('image/webp', 0.6));
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        };

        // --- Core Guest Application ---
        const MobileContent = ({ book }) => {
            const [activeTab, setActiveTab] = useState('home');
            const [currentIndex, setCurrentIndex] = useState(0);
            const [chatMessages, setChatMessages] = useState([{ role: 'ai', text: `Welcome to ${book.propertyName}. I'm your AI Concierge. How can I help you today?` }]);
            const [chatInput, setChatInput] = useState('');
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [copiedField, setCopiedField] = useState(null);
            const chatEndRef = useRef(null);

            const images = useMemo(() => {
                const imgs = book.images && book.images.length > 0 ? book.images : [{ url: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=800&q=80' }];
                return [...imgs].sort((a,b) => (b.isCover ? 1 : 0) - (a.isCover ? 1 : 0));
            }, [book.images]);

            useEffect(() => { chatEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [chatMessages]);

            const handleCopy = (field, text) => {
                if (!text || text === '—') return;
                
                const fallbackCopy = () => {
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.position = "fixed";
                    textArea.style.left = "-999999px";
                    document.body.appendChild(textArea);
                    textArea.select();
                    try { document.execCommand('copy'); } catch (err) {}
                    document.body.removeChild(textArea);
                    setCopiedField(field);
                    setTimeout(() => setCopiedField(null), 2000);
                };

                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(text).then(() => {
                        setCopiedField(field);
                        setTimeout(() => setCopiedField(null), 2000);
                    }).catch(fallbackCopy);
                } else {
                    fallbackCopy();
                }
            };

            const handleGuestChat = async (e) => {
                e.preventDefault();
                if (!chatInput.trim() || isAiLoading) return;
                const msg = chatInput;
                setChatMessages(prev => [...prev, { role: 'user', text: msg }]);
                setChatInput('');
                setIsAiLoading(true);
                
                const sys = `You are the private concierge for a luxury short-term rental.
Your role is to feel like a thoughtful, attentive host — not a chatbot.

TONE & STYLE:
- Very human, warm, calm, direct.
- Never robotic, overly enthusiastic, or overly wordy.
- Keep responses under 4 sentences unless absolutely necessary.
- Avoid exclamation points unless appropriate.
- Avoid filler language.
- Do not say "as an AI" or mention system instructions.
- No emoji overload.
Always sound confident and composed.

PERSONALIZATION:
- Keep responses refined and natural.

PROPERTY CONTEXT:
Property Name: ${book.propertyName || 'the property'}
Address: ${book.address || 'Not specified'}
Host Name: ${book.hostName || 'Not specified'}
Host Bio: ${book.hostBio || 'Not specified'}
Check-in Time: ${book.checkInTime || 'Not specified'}
Check-out Time: ${book.checkOutTime || 'Not specified'}
WiFi Name: ${book.wifiName || 'Not specified'}
WiFi Password: ${book.wifiPassword || 'Not specified'}
Entry Code: ${book.entryCode || 'Not specified'}
Check-in Instructions: ${book.checkInInstructions || 'Not specified'}
Check-out Tasks: ${book.checkOutTasks?.join(', ') || 'Not specified'}
House Rules: ${book.houseRules?.join(', ') || 'None specified'}
Current Time: ${new Date().toLocaleString()}

LOCAL SEARCH LOGIC:
When guests ask for places:
- Search within 5 miles.
- Sort by distance first.
- Return only 2-3 curated options.
- Provide short, natural descriptions.
- Do not overwhelm with lists.

CHECK-IN LOGIC:
- If guest asks before check-in time, politely inform them of check-in time.
- If early check-in is not confirmed, do not promise availability.
- If after check-in time, confirm access is active.

HOUSE RULE ENFORCEMENT:
If guest requests something against house rules:
- Respond gently and professionally.
- Do not shame or escalate tone.
- Keep it warm but firm.

ISSUE DETECTION:
If guest mentions leak, no heat, no AC, lock issue, power outage, or safety concern:
1. Acknowledge calmly.
2. Offer quick troubleshooting if possible.
3. Inform them the host has been notified.
Never dismiss urgency.

PROACTIVE ELEGANCE & UPSELL:
- Suggest indoor alternatives if weather is poor, or outdoor options if ideal.
- If guest hints at celebration, late departure, or early arrival, gently mention available options if natural. Never aggressively sell.

FINAL RULE:
Visible experience must feel simple. Behind the scenes, use all available context to provide intelligent, curated responses. Respond elegantly.`;

                const res = await callGemini(msg, sys);
                setChatMessages(prev => [...prev, { role: 'ai', text: res }]);
                setIsAiLoading(false);
            };

            const renderHome = () => (
                <div className="animate-in pb-32 overflow-y-auto no-scrollbar bg-stone-50">
                    <div className="relative h-[45vh] md:h-[55vh] bg-zinc-100 overflow-hidden group">
                        {images.map((img, idx) => (
                            <img key={idx} src={img.url} className={`absolute inset-0 w-full h-full object-cover transition-opacity duration-700 ${idx === currentIndex ? 'opacity-100 scale-100' : 'opacity-0 scale-105'}`} />
                        ))}
                        <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"></div>
                        
                        {images.length > 1 && (
                            <div className="absolute inset-0 flex items-center justify-between px-4 md:px-8 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                <button onClick={() => setCurrentIndex(p => (p - 1 + images.length) % images.length)} className="p-2 rounded-full bg-black/30 text-white backdrop-blur-md active:scale-90 transition-transform"><Icon name="chevron-left" size={20}/></button>
                                <button onClick={() => setCurrentIndex(p => (p + 1) % images.length)} className="p-2 rounded-full bg-black/30 text-white backdrop-blur-md active:scale-90 transition-transform"><Icon name="chevron-right" size={20}/></button>
                            </div>
                        )}
                        
                        <div className="absolute bottom-10 left-6 right-6 md:left-8 md:right-8 text-white text-left z-10">
                            <p className="text-[9px] font-black uppercase tracking-[0.3em] opacity-90 mb-1 drop-shadow-md">Luxury Stay</p>
                            <h1 className="text-3xl md:text-4xl font-serif italic leading-tight drop-shadow-lg">{book.propertyName}</h1>
                        </div>
                    </div>

                    {/* Overlapping Content Sheet */}
                    <div className="relative z-20 bg-stone-50 rounded-t-[2rem] -mt-6 px-5 md:px-8 pt-8 pb-24 max-w-4xl mx-auto flex flex-col space-y-6 md:space-y-8">
                        
                        {/* Note from Host */}
                        <div className="bg-white p-5 md:p-6 rounded-3xl shadow-[0_4px_20px_rgb(0,0,0,0.03)] border border-stone-100 relative overflow-hidden">
                            <div className="absolute left-0 top-0 bottom-0 w-1.5" style={{ backgroundColor: book.accentColor || '#18181b' }}></div>
                            <h2 className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-2 ml-3">A Note from your Host</h2>
                            <p className="font-serif italic text-base md:text-lg text-zinc-800 leading-relaxed ml-3">"{book.welcomeMessage}"</p>
                        </div>

                        {/* Quick Actions Grid */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                            <div className="bg-white p-4 rounded-2xl border border-stone-100/60 text-center flex flex-col items-center justify-center shadow-sm hover:shadow-md transition-shadow group">
                                <div className="w-10 h-10 rounded-full bg-orange-50 flex items-center justify-center text-orange-400 mb-2 group-hover:scale-110 transition-transform"><Icon name="sun" size={18}/></div>
                                <p className="text-[9px] uppercase font-black text-zinc-400 tracking-[0.1em] mb-0.5">Weather</p>
                                <p className="text-sm font-bold text-zinc-900">24°C</p>
                            </div>
                            <div onClick={() => window.open(`https://maps.google.com/?q=${encodeURIComponent(book.address)}`)} className="bg-white p-4 rounded-2xl border border-stone-100/60 text-center flex flex-col items-center justify-center cursor-pointer shadow-sm hover:shadow-md transition-all active:scale-95 group">
                                <div className="w-10 h-10 rounded-full bg-zinc-50 flex items-center justify-center text-zinc-900 mb-2 group-hover:bg-zinc-900 group-hover:text-white transition-colors"><Icon name="map-pin" size={18}/></div>
                                <p className="text-[9px] uppercase font-black text-zinc-400 tracking-[0.1em] mb-0.5">Map</p>
                                <p className="text-xs font-bold text-zinc-900 line-clamp-1 px-1 w-full">{book.address || 'Location'}</p>
                            </div>
                            <div onClick={() => setActiveTab('wifi')} className="bg-white p-4 rounded-2xl border border-stone-100/60 text-center flex flex-col items-center justify-center cursor-pointer shadow-sm hover:shadow-md transition-all active:scale-95 group">
                                <div className="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-500 mb-2 group-hover:bg-blue-500 group-hover:text-white transition-colors"><Icon name="wifi" size={18}/></div>
                                <p className="text-[9px] uppercase font-black text-zinc-400 tracking-[0.1em] mb-0.5">Wi-Fi</p>
                                <p className="text-xs font-bold text-zinc-900 truncate w-full px-1">{book.wifiName || 'Connect'}</p>
                            </div>
                            <div className="bg-white p-4 rounded-2xl border border-stone-100/60 text-center flex flex-col items-center justify-center shadow-sm hover:shadow-md transition-shadow group">
                                <div className="w-10 h-10 rounded-full bg-emerald-50 flex items-center justify-center text-emerald-600 mb-2 group-hover:scale-110 transition-transform"><Icon name="key" size={18}/></div>
                                <p className="text-[9px] uppercase font-black text-zinc-400 tracking-[0.1em] mb-0.5">Access</p>
                                <p className="text-sm font-bold text-zinc-900 truncate w-full px-1">{book.entryCode || 'Secure'}</p>
                            </div>
                        </div>

                        {/* Check-in / Check-out Times */}
                        <div className="bg-zinc-900 rounded-3xl p-6 md:p-8 text-white shadow-xl relative overflow-hidden flex flex-col sm:flex-row sm:items-center justify-between gap-5 md:gap-6">
                            <div className="absolute top-0 right-0 w-48 h-48 bg-white/5 rounded-full blur-2xl -mr-12 -mt-12 pointer-events-none"></div>
                            
                            <div className="flex flex-col sm:flex-row items-start sm:items-center gap-5 sm:gap-8 md:gap-12 relative z-10 w-full">
                                <div className="flex-1 w-full min-w-0">
                                    <p className="text-[9px] text-zinc-400 font-black uppercase tracking-[0.2em] mb-1 flex items-center">
                                        <Icon name="arrow-down-right" size={12} className="mr-1.5 shrink-0" /> <span className="truncate">Arrive After</span>
                                    </p>
                                    <p className="font-serif italic text-2xl md:text-3xl truncate">{book.checkInTime}</p>
                                </div>
                                <div className="hidden sm:block w-px h-10 bg-white/10 shrink-0"></div>
                                <div className="w-full sm:hidden h-px bg-white/10 shrink-0"></div>
                                <div className="flex-1 w-full min-w-0">
                                    <p className="text-[9px] text-zinc-400 font-black uppercase tracking-[0.2em] mb-1 flex items-center">
                                        <Icon name="arrow-up-right" size={12} className="mr-1.5 shrink-0" /> <span className="truncate">Depart By</span>
                                    </p>
                                    <p className="font-serif italic text-2xl md:text-3xl truncate">{book.checkOutTime}</p>
                                </div>
                            </div>
                        </div>

                        {/* House Rules */}
                        {book.houseRules?.length > 0 && (
                            <div className="pt-2">
                                <h3 className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-3 px-2">House Rules</h3>
                                <ul className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    {book.houseRules.map((r, i) => (
                                        <li key={i} className="bg-white border border-stone-100 rounded-2xl p-4 text-sm font-medium text-zinc-700 leading-snug flex items-start shadow-sm">
                                            <span className="text-zinc-300 mr-2.5 mt-0.5 shrink-0">•</span>
                                            <span className="break-words min-w-0">{r}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}

                    </div>
                </div>
            );

            return (
                <div className="flex flex-col h-full bg-stone-50 text-zinc-900 select-none overflow-hidden relative">
                    <div className="flex-1 overflow-y-auto no-scrollbar">
                        {activeTab === 'home' && renderHome()}

                        {activeTab === 'checkin' && (
                            <div className="p-5 md:p-8 pt-10 md:pt-12 pb-32 md:pb-40 space-y-6 md:space-y-8 animate-in text-left max-w-4xl mx-auto w-full">
                                <div className="flex items-center space-x-3 md:space-x-4 border-b border-stone-200 pb-4">
                                    <div className="w-10 h-10 md:w-12 md:h-12 bg-zinc-900 text-white rounded-xl flex items-center justify-center shadow-md transform -rotate-3 shrink-0">
                                        <Icon name="door-open" size={20} />
                                    </div>
                                    <h2 className="text-2xl md:text-3xl font-serif italic text-zinc-900 tracking-tight truncate">Arrival</h2>
                                </div>

                                {/* Premium Check-In Summary Card */}
                                <div className="bg-zinc-900 text-white rounded-3xl p-6 md:p-8 shadow-xl relative overflow-hidden group border border-zinc-800">
                                    <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full blur-xl -mr-8 -mt-8 pointer-events-none transition-transform duration-1000 group-hover:scale-110"></div>
                                    
                                    <div className="relative z-10 space-y-5 md:space-y-6">
                                        {/* Check In Time */}
                                        <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                                            <div className="min-w-0 w-full">
                                                <p className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-1 truncate">Check-In Time</p>
                                                <p className="text-2xl md:text-3xl font-serif italic text-white truncate">{book.checkInTime || '—'}</p>
                                            </div>
                                        </div>

                                        <div className="w-full h-px bg-white/10"></div>

                                        {/* Entry Code */}
                                        <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                                            <div className="flex-1 min-w-0">
                                                <p className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-2 truncate">Entry Code</p>
                                                <div className="inline-flex items-center bg-white/5 border border-white/10 px-4 py-2 rounded-xl backdrop-blur-sm max-w-full">
                                                    <p className="text-xl md:text-2xl font-mono tracking-widest text-white truncate">{book.entryCode || '—'}</p>
                                                </div>
                                            </div>
                                            <button onClick={() => handleCopy('entryCode', book.entryCode)} className="w-10 h-10 md:w-12 md:h-12 flex items-center justify-center bg-white/10 border border-white/10 hover:bg-white text-white hover:text-zinc-900 rounded-xl transition-all backdrop-blur-md shrink-0 active:scale-95 shadow-sm mt-1 sm:mt-0">
                                                {copiedField === 'entryCode' ? <Icon name="check" size={18} /> : <Icon name="copy" size={18} />}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Arrival Instructions */}
                                {book.checkInInstructions && (
                                    <div className="pt-2">
                                        <h3 className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-3 px-2">Arrival Guide</h3>
                                        <div className="bg-white border border-stone-100 rounded-3xl p-5 md:p-6 shadow-sm">
                                            <p className="text-sm md:text-base text-zinc-700 leading-relaxed whitespace-pre-wrap break-words">{book.checkInInstructions}</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'checkout' && (
                            <div className="p-5 md:p-8 pt-10 md:pt-12 pb-32 md:pb-40 space-y-6 md:space-y-8 animate-in text-left max-w-4xl mx-auto w-full">
                                <div className="flex items-center space-x-3 md:space-x-4 border-b border-stone-200 pb-4">
                                    <div className="w-10 h-10 md:w-12 md:h-12 bg-zinc-900 text-white rounded-xl flex items-center justify-center shadow-md transform -rotate-3 shrink-0">
                                        <Icon name="door-closed" size={20} />
                                    </div>
                                    <h2 className="text-2xl md:text-3xl font-serif italic text-zinc-900 tracking-tight truncate">Departure</h2>
                                </div>

                                {/* Check-Out Time Card */}
                                <div className="bg-zinc-900 text-white rounded-3xl p-6 md:p-8 shadow-xl relative overflow-hidden group border border-zinc-800">
                                    <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full blur-xl -mr-8 -mt-8 pointer-events-none transition-transform duration-1000 group-hover:scale-110"></div>
                                    <div className="relative z-10 min-w-0">
                                        <p className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-1 truncate">Check-Out Time</p>
                                        <p className="text-2xl md:text-3xl font-serif italic text-white truncate">{book.checkOutTime || '—'}</p>
                                    </div>
                                </div>

                                {/* Interactive Departure Checklist */}
                                {book.checkOutTasks?.length > 0 && (
                                    <div className="pt-2">
                                        <h3 className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-3 px-2">Departure Checklist</h3>
                                        <div className="bg-white border border-stone-100 rounded-3xl p-5 md:p-6 shadow-sm">
                                            <ul className="space-y-3 md:space-y-4">
                                                {book.checkOutTasks.map((t, i) => (
                                                    <li key={i}>
                                                        <label className="flex items-start group cursor-pointer">
                                                            <input type="checkbox" className="peer sr-only" />
                                                            <div className="w-5 h-5 rounded-full border-2 border-stone-200 mr-3 flex-shrink-0 mt-0.5 flex items-center justify-center text-transparent peer-checked:bg-zinc-900 peer-checked:border-zinc-900 peer-checked:text-white transition-all shadow-sm">
                                                                <Icon name="check" size={12} />
                                                            </div>
                                                            <span className="text-sm font-medium text-zinc-700 leading-snug pt-0.5 peer-checked:text-zinc-400 peer-checked:line-through transition-all select-none break-words min-w-0">{t}</span>
                                                        </label>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'wifi' && (
                            <div className="p-5 md:p-8 pt-10 md:pt-12 pb-32 md:pb-40 space-y-6 md:space-y-8 animate-in text-left max-w-4xl mx-auto w-full">
                                <div className="flex items-center space-x-3 md:space-x-4 border-b border-stone-200 pb-4">
                                    <div className="w-10 h-10 md:w-12 md:h-12 bg-zinc-900 text-white rounded-xl flex items-center justify-center shadow-md transform -rotate-3 shrink-0">
                                        <Icon name="wifi" size={20} />
                                    </div>
                                    <h2 className="text-2xl md:text-3xl font-serif italic text-zinc-900 tracking-tight truncate">Connectivity</h2>
                                </div>

                                {/* Premium Network Card */}
                                <div className="bg-zinc-900 text-white rounded-3xl p-6 md:p-8 shadow-xl relative overflow-hidden group border border-zinc-800">
                                    {/* Decorative background blurs for modern feel */}
                                    <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full blur-xl -mr-8 -mt-8 pointer-events-none transition-transform duration-1000 group-hover:scale-110"></div>
                                    <div className="absolute bottom-0 left-0 w-24 h-24 bg-zinc-700/30 rounded-full blur-lg -ml-8 -mb-8 pointer-events-none"></div>

                                    <div className="relative z-10 space-y-5 md:space-y-6">
                                        {/* Network Name (SSID) */}
                                        <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3 md:gap-4">
                                            <div className="flex-1 min-w-0">
                                                <p className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-1 flex items-center truncate">
                                                    <span className="w-2 h-2 rounded-full bg-green-400 mr-2 animate-pulse shrink-0"></span>
                                                    Network Name (SSID)
                                                </p>
                                                <p className="text-lg md:text-xl font-bold tracking-tight text-white truncate">{book.wifiName || '—'}</p>
                                            </div>
                                            <button onClick={() => handleCopy('wifiName', book.wifiName)} className="w-10 h-10 md:w-12 md:h-12 flex items-center justify-center bg-white/10 border border-white/10 hover:bg-white text-white hover:text-zinc-900 rounded-xl transition-all backdrop-blur-md shrink-0 active:scale-95 shadow-sm mt-1 sm:mt-0">
                                                {copiedField === 'wifiName' ? <Icon name="check" size={18} /> : <Icon name="copy" size={18} />}
                                            </button>
                                        </div>

                                        <div className="w-full h-px bg-white/10"></div>

                                        {/* Password */}
                                        <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3 md:gap-4">
                                            <div className="flex-1 min-w-0">
                                                <p className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-2 truncate">Password</p>
                                                <div className="inline-flex items-center bg-white/5 border border-white/10 px-3 md:px-4 py-2 rounded-xl backdrop-blur-sm max-w-full">
                                                    <p className="text-base md:text-lg font-mono tracking-widest text-white truncate">{book.wifiPassword || '—'}</p>
                                                </div>
                                            </div>
                                            <button onClick={() => handleCopy('wifiPassword', book.wifiPassword)} className="w-10 h-10 md:w-12 md:h-12 flex items-center justify-center bg-white/10 border border-white/10 hover:bg-white text-white hover:text-zinc-900 rounded-xl transition-all backdrop-blur-md shrink-0 active:scale-95 shadow-sm mt-1 sm:mt-0">
                                                {copiedField === 'wifiPassword' ? <Icon name="check" size={18} /> : <Icon name="copy" size={18} />}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Secondary Info Grid */}
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 pt-2">
                                    <div className="bg-white p-4 md:p-5 rounded-2xl border border-stone-100 flex items-start space-x-3 hover:shadow-sm transition-shadow">
                                        <div className="w-8 h-8 bg-stone-50 rounded-full flex items-center justify-center shrink-0 text-zinc-400">
                                            <Icon name="zap" size={16} />
                                        </div>
                                        <div className="min-w-0">
                                            <p className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-0.5 truncate">Network Tips</p>
                                            <p className="text-xs font-medium text-zinc-700 leading-snug break-words">Experience high-speed 4K streaming seamlessly on 5GHz.</p>
                                        </div>
                                    </div>
                                    <div className="bg-white p-4 md:p-5 rounded-2xl border border-stone-100 flex items-start space-x-3 hover:shadow-sm transition-shadow">
                                        <div className="w-8 h-8 bg-stone-50 rounded-full flex items-center justify-center shrink-0 text-zinc-400">
                                            <Icon name="message-circle" size={16} />
                                        </div>
                                        <div className="min-w-0">
                                            <p className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-0.5 truncate">Support</p>
                                            <p className="text-xs font-medium text-zinc-700 leading-snug break-words">Having connectivity issues? Ask your concierge in Chat.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'eat' && (
                            <div className="p-5 md:p-8 pt-10 md:pt-12 pb-32 md:pb-40 space-y-8 md:space-y-10 animate-in text-left max-w-6xl mx-auto w-full">
                                <h2 className="text-2xl md:text-3xl font-serif italic border-b border-stone-200 pb-4 truncate">Local Curation</h2>
                                {['Food', 'Grocery'].map(type => (
                                    <section key={type} className="space-y-4 md:space-y-6">
                                        <h3 className="text-[9px] font-black uppercase tracking-[0.2em] flex items-center text-zinc-400 truncate">
                                            <div className={`w-1.5 h-5 rounded-full mr-2.5 shrink-0 ${type === 'Food' ? 'bg-zinc-900' : 'bg-stone-300'}`} />
                                            {type === 'Food' ? 'Elite Dining' : 'Provisions'}
                                        </h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                                            {book.recommendations?.filter(r => r.type === type).map(item => (
                                                <div key={item.id} className="bg-white p-5 rounded-2xl md:rounded-3xl border border-stone-100 shadow-sm flex flex-col space-y-2.5 hover:shadow-md transition-all group">
                                                    <div className="flex justify-between items-start gap-3">
                                                        <h4 className="font-serif italic text-lg md:text-xl leading-tight text-zinc-900 break-words min-w-0">{item.name}</h4>
                                                        <span className="text-[8px] md:text-[9px] font-black text-zinc-400 tracking-widest bg-stone-50 px-2 py-1 rounded-full shrink-0 whitespace-nowrap">{item.distance} MI</span>
                                                    </div>
                                                    <p className="text-sm text-zinc-500 leading-relaxed break-words">"{item.description}"</p>
                                                </div>
                                            ))}
                                            {book.recommendations?.filter(r => r.type === type).length === 0 && (
                                                <p className="text-xs text-zinc-400 italic bg-stone-50 p-4 rounded-2xl break-words">No recommendations added yet.</p>
                                            )}
                                        </div>
                                    </section>
                                ))}
                            </div>
                        )}
                        
                        {activeTab === 'host' && (
                            <div className="p-5 md:p-8 pt-10 md:pt-12 pb-32 md:pb-40 space-y-6 md:space-y-8 animate-in text-left max-w-4xl mx-auto w-full">
                                <div className="flex items-center space-x-3 md:space-x-4 border-b border-stone-200 pb-4">
                                    <div className="w-10 h-10 md:w-12 md:h-12 bg-zinc-900 text-white rounded-xl flex items-center justify-center shadow-md transform -rotate-3 shrink-0">
                                        <Icon name="user" size={20} />
                                    </div>
                                    <h2 className="text-2xl md:text-3xl font-serif italic text-zinc-900 tracking-tight truncate">Your Host</h2>
                                </div>

                                <div className="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-stone-100 flex flex-col sm:flex-row gap-5 items-center sm:items-start text-center sm:text-left transition-all hover:shadow-md">
                                    <div className="w-20 h-20 bg-stone-50 rounded-full flex items-center justify-center text-zinc-300 shrink-0 border-4 border-white shadow-md overflow-hidden relative">
                                        {book.hostImage ? (
                                            <img src={book.hostImage} alt="Host" className="w-full h-full object-cover" />
                                        ) : (
                                            <Icon name="user" size={36} className="absolute mt-4" />
                                        )}
                                    </div>
                                    <div className="space-y-2 flex-1">
                                        <p className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400">About</p>
                                        <h3 className="text-xl md:text-2xl font-serif italic text-zinc-900">{book.hostName || 'Your Host'}</h3>
                                        <p className="text-sm text-zinc-600 leading-relaxed whitespace-pre-wrap">{book.hostBio || 'No host information provided yet.'}</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'chat' && (
                            <div className="flex flex-col h-full bg-stone-50 pt-16 px-4 md:px-8 animate-in relative overflow-hidden">
                                <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-36 md:pb-40 flex flex-col max-w-4xl mx-auto w-full">
                                    {chatMessages.map((m, i) => <div key={i} className={`chat-bubble ${m.role === 'ai' ? 'bubble-ai shadow-lg text-left' : 'bubble-guest shadow-sm border border-stone-200 text-left bg-white'} break-words text-sm`}>{m.text}</div>)}
                                    {isAiLoading && <div className="bubble-ai chat-bubble animate-pulse text-sm">Assistant is thinking...</div>}
                                    <div ref={chatEndRef} />
                                </div>
                                <form onSubmit={handleGuestChat} className="fixed bottom-20 inset-x-4 sm:inset-x-8 max-w-4xl mx-auto p-2.5 md:p-3 bg-white/90 backdrop-blur-md border border-stone-100 shadow-xl rounded-full flex space-x-2">
                                    <input value={chatInput} onChange={e => setChatInput(e.target.value)} placeholder="Ask concierge..." className="flex-1 bg-transparent px-4 py-2 text-sm outline-none min-w-0" />
                                    <button type="submit" className="p-3 bg-zinc-900 text-white rounded-full hover:scale-105 transition-all shrink-0"><Icon name="send" size={16} /></button>
                                </form>
                            </div>
                        )}
                    </div>
                    
                    {/* Unified Bottom Navigation */}
                    <div className="absolute bottom-4 sm:bottom-6 inset-x-4 sm:inset-x-6 z-50 flex justify-center">
                        <div className="bg-white/90 backdrop-blur-2xl border border-zinc-100 px-4 py-3 rounded-full shadow-2xl flex items-center space-x-4 sm:space-x-6 overflow-x-auto no-scrollbar max-w-full justify-start sm:justify-center">
                            {[
                                {t:'home',i:'home'}, 
                                {t:'checkin',i:'door-open'}, 
                                {t:'checkout',i:'door-closed'}, 
                                {t:'wifi',i:'wifi'}, 
                                {t:'eat',i:'utensils'}, 
                                {t:'host',i:'user'},
                                {t:'chat',i:'sparkles'}
                            ].map(b => (
                                <button key={b.t} onClick={() => setActiveTab(b.t)} className={`flex-shrink-0 p-1.5 transition-all duration-300 ${activeTab === b.t ? 'text-zinc-900 scale-110 sm:scale-125' : 'text-zinc-400 hover:text-zinc-600'}`}>
                                    <Icon name={b.i} size={20} className="sm:w-5 sm:h-5" />
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- NEW EDITOR COMPONENTS ---
        const ImageUploader = ({ images = [], onChange }) => {
            const fileInputRef = useRef(null);

            const handleUpload = async (e) => {
                const files = Array.from(e.target.files);
                if (!files.length) return;
                
                const newImages = await Promise.all(files.map(async (f) => {
                    const dataUrl = await processImageFile(f);
                    return { id: 'img_' + Date.now() + Math.random(), url: dataUrl, isCover: false };
                }));
                
                let combined = [...images, ...newImages];
                if (combined.length > 0 && !combined.find(img => img.isCover)) {
                    combined[0].isCover = true;
                }
                onChange(combined);
                if(fileInputRef.current) fileInputRef.current.value = "";
            };

            const setCover = (id) => {
                onChange(images.map(img => ({ ...img, isCover: img.id === id })));
            };

            const removeImg = (id) => {
                const next = images.filter(img => img.id !== id);
                if (next.length > 0 && !next.find(i => i.isCover)) next[0].isCover = true;
                onChange(next);
            };

            const moveImg = (index, dir) => {
                if (index + dir < 0 || index + dir >= images.length) return;
                const next = [...images];
                const temp = next[index];
                next[index] = next[index + dir];
                next[index + dir] = temp;
                onChange(next);
            };

            return (
                <div className="space-y-4">
                    <div className="image-grid">
                        {images.map((img, index) => (
                            <div key={img.id} className={`relative h-28 sm:h-32 rounded-2xl overflow-hidden group border-[3px] ${img.isCover ? 'border-zinc-900 shadow-md' : 'border-transparent'}`}>
                                <img src={img.url} className="w-full h-full object-cover" />
                                <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-between p-2">
                                    <div className="flex justify-between gap-1">
                                        {!img.isCover && (
                                            <button onClick={() => setCover(img.id)} className="text-[8px] sm:text-[9px] bg-white/90 text-zinc-900 px-2 py-1 rounded-md font-bold uppercase hover:bg-white truncate" title="Set as Cover">Cover</button>
                                        )}
                                        {img.isCover && <span className="text-[8px] sm:text-[9px] bg-zinc-900 text-white px-2 py-1 rounded-md font-bold uppercase truncate">Cover</span>}
                                        <button onClick={() => removeImg(img.id)} className="bg-red-500/90 text-white p-1.5 rounded-md hover:bg-red-600 shrink-0"><Icon name="trash-2" size={12} className="sm:w-3.5 sm:h-3.5" /></button>
                                    </div>
                                    <div className="flex justify-between gap-2">
                                        <button onClick={() => moveImg(index, -1)} disabled={index === 0} className="flex-1 bg-white/90 disabled:opacity-50 text-zinc-900 py-1 rounded-md flex justify-center hover:bg-white"><Icon name="arrow-left" size={14} className="sm:w-4 sm:h-4" /></button>
                                        <button onClick={() => moveImg(index, 1)} disabled={index === images.length - 1} className="flex-1 bg-white/90 disabled:opacity-50 text-zinc-900 py-1 rounded-md flex justify-center hover:bg-white"><Icon name="arrow-right" size={14} className="sm:w-4 sm:h-4" /></button>
                                    </div>
                                </div>
                            </div>
                        ))}
                        <button onClick={() => fileInputRef.current?.click()} className="h-28 sm:h-32 rounded-2xl border-2 border-dashed border-stone-200 flex flex-col items-center justify-center text-zinc-400 hover:bg-stone-50 hover:border-zinc-400 hover:text-zinc-600 transition-colors">
                            <Icon name="upload" size={20} className="mb-2 sm:w-6 sm:h-6" />
                            <span className="text-[9px] sm:text-[10px] font-black uppercase tracking-widest truncate px-1 w-full text-center">Upload</span>
                        </button>
                        <input type="file" accept="image/*" multiple className="hidden" ref={fileInputRef} onChange={handleUpload} />
                    </div>
                </div>
            );
        };

        const AddressAutocomplete = ({ value, onChange }) => {
            const [input, setInput] = useState(value || '');
            const [suggestions, setSuggestions] = useState([]);
            const [isOpen, setIsOpen] = useState(false);
            const debounceRef = useRef(null);

            const fetchSuggestions = async (query) => {
                if (!query || query.length < 3) { setSuggestions([]); return; }
                try {
                    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&addressdetails=1&limit=5`);
                    const data = await res.json();
                    setSuggestions(data);
                } catch (e) { console.error("Autocomplete fetch error", e); }
            };

            const handleInputChange = (e) => {
                const val = e.target.value;
                setInput(val);
                onChange(val);
                setIsOpen(true);
                
                if (debounceRef.current) clearTimeout(debounceRef.current);
                debounceRef.current = setTimeout(() => fetchSuggestions(val), 400);
            };

            const handleSelect = (suggestion) => {
                setInput(suggestion.display_name);
                onChange(suggestion.display_name);
                setIsOpen(false);
            };

            return (
                <div className="relative">
                    <div className="flex items-center bg-stone-50 p-3 md:p-5 rounded-[1.5rem] focus-within:ring-1 ring-zinc-200 transition-all border border-transparent focus-within:border-zinc-200 focus-within:bg-white">
                        <Icon name="map-pin" size={18} className="text-zinc-400 mr-3 shrink-0" />
                        <input 
                            value={input} 
                            onChange={handleInputChange} 
                            onBlur={() => setTimeout(() => setIsOpen(false), 200)}
                            placeholder="Start typing an address..." 
                            className="w-full bg-transparent text-sm md:text-base outline-none text-zinc-900 min-w-0" 
                        />
                    </div>
                    {isOpen && suggestions.length > 0 && (
                        <ul className="absolute z-50 w-full mt-2 bg-white rounded-[1.5rem] shadow-xl border border-stone-100 overflow-hidden max-h-60 overflow-y-auto">
                            {suggestions.map(s => (
                                <li key={s.place_id} onClick={() => handleSelect(s)} className="p-3 md:p-4 hover:bg-stone-50 cursor-pointer text-sm text-zinc-600 border-b border-stone-50 last:border-0 truncate transition-colors">
                                    {s.display_name}
                                </li>
                            ))}
                        </ul>
                    )}
                </div>
            );
        };

        const ListEditor = ({ items = [], onChange, placeholder="Add an item..." }) => {
            const [newItem, setNewItem] = useState('');
            const [editIndex, setEditIndex] = useState(-1);
            const [editText, setEditText] = useState('');

            const handleAdd = (e) => {
                e.preventDefault();
                if (!newItem.trim()) return;
                onChange([...items, newItem.trim()]);
                setNewItem('');
            };

            const handleRemove = (i) => {
                onChange(items.filter((_, idx) => idx !== i));
            };

            const startEdit = (i, text) => {
                setEditIndex(i);
                setEditText(text);
            };

            const saveEdit = (e) => {
                e.preventDefault();
                const next = [...items];
                next[editIndex] = editText.trim();
                onChange(next);
                setEditIndex(-1);
            };

            return (
                <div className="space-y-4 md:space-y-6">
                    <form onSubmit={handleAdd} className="flex flex-col sm:flex-row gap-2 sm:space-x-3">
                        <input value={newItem} onChange={e => setNewItem(e.target.value)} placeholder={placeholder} className="flex-1 bg-stone-50 px-4 md:px-5 py-3 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all min-w-0" />
                        <button type="submit" disabled={!newItem.trim()} className="bg-zinc-900 text-white px-6 md:px-8 py-3 md:py-4 rounded-xl md:rounded-[1.5rem] font-black text-xs uppercase tracking-widest disabled:opacity-50 hover:bg-zinc-800 transition-colors w-full sm:w-auto">Add</button>
                    </form>
                    <ul className="space-y-2 md:space-y-3">
                        {items.map((item, i) => (
                            <li key={i} className="flex items-start bg-white border border-stone-100 p-4 md:p-5 rounded-xl md:rounded-[1.5rem] group transition-all hover:shadow-sm hover:border-stone-200">
                                {editIndex === i ? (
                                    <form onSubmit={saveEdit} className="flex-1 flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:space-x-3 w-full">
                                        <input autoFocus value={editText} onChange={e => setEditText(e.target.value)} className="flex-1 text-sm md:text-base outline-none bg-stone-50 px-3 md:px-4 py-2 rounded-xl border border-zinc-200 w-full min-w-0" />
                                        <div className="flex space-x-2 shrink-0">
                                            <button type="submit" className="text-green-600 hover:text-green-700 bg-green-50 p-2 rounded-xl"><Icon name="check" size={16} className="md:w-[18px] md:h-[18px]" /></button>
                                            <button type="button" onClick={() => setEditIndex(-1)} className="text-zinc-400 hover:text-zinc-600 bg-stone-50 p-2 rounded-xl"><Icon name="x" size={16} className="md:w-[18px] md:h-[18px]" /></button>
                                        </div>
                                    </form>
                                ) : (
                                    <>
                                        <span className="text-zinc-300 mr-3 md:mr-4 mt-0.5 md:mt-1 shrink-0">•</span>
                                        <span className="flex-1 text-sm md:text-base text-zinc-700 break-words min-w-0">{item}</span>
                                        <div className="flex space-x-1 md:space-x-2 opacity-100 sm:opacity-0 group-hover:opacity-100 transition-opacity shrink-0 ml-2 md:ml-4">
                                            <button onClick={() => startEdit(i, item)} className="text-zinc-400 hover:text-blue-500 p-1.5 md:p-2 rounded-xl hover:bg-blue-50 transition-colors"><Icon name="edit-3" size={14} className="md:w-4 md:h-4" /></button>
                                            <button onClick={() => handleRemove(i)} className="text-zinc-400 hover:text-red-500 p-1.5 md:p-2 rounded-xl hover:bg-red-50 transition-colors"><Icon name="trash-2" size={14} className="md:w-4 md:h-4" /></button>
                                        </div>
                                    </>
                                )}
                            </li>
                        ))}
                    </ul>
                    {items.length === 0 && <p className="text-sm text-zinc-400 italic px-2">No items added yet.</p>}
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('landing');
            const [landingTab, setLandingTab] = useState('login');
            const [previewMode, setPreviewMode] = useState('mobile'); 
            const [isAiLoading, setIsAiLoading] = useState(null);
            
            // Editor State
            const [editorTab, setEditorTab] = useState('basics');

            // Persistent State Initialization
            const [portfolios, setPortfolios] = useState(() => {
                try {
                    const saved = localStorage.getItem(LOCAL_STORAGE_KEY);
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        if (Array.isArray(parsed) && parsed.length > 0 && Array.isArray(parsed[0].books)) {
                            return parsed;
                        }
                        if (Array.isArray(parsed) && parsed.length > 0 && parsed[0].propertyName) {
                            return [{ id: 'default', name: 'My Portfolio', books: parsed }];
                        }
                        if (Array.isArray(parsed) && parsed.length === 0) {
                            return [{ id: 'default', name: 'My Portfolio', books: [] }];
                        }
                    }
                } catch (e) { console.error("Could not load from localStorage", e); }
                return [{ id: 'default', name: 'My Portfolio', books: INITIAL_GUEST_BOOKS }];
            });

            const [activePortfolioId, setActivePortfolioId] = useState(portfolios[0]?.id || 'default');
            const activePort = portfolios.find(p => p.id === activePortfolioId) || portfolios[0];
            const books = activePort?.books || [];
            
            const [activeBookId, setActiveBookId] = useState(books.length > 0 ? books[0].id : null);
            const [editingBook, setEditingBook] = useState(null);

            // Modal State
            const [portfolioModal, setPortfolioModal] = useState({ isOpen: false, mode: 'create', name: '', id: null });

            const openCreateModal = () => setPortfolioModal({ isOpen: true, mode: 'create', name: '', id: null });
            const openRenameModal = (port) => setPortfolioModal({ isOpen: true, mode: 'rename', name: port.name, id: port.id });

            const submitPortfolioModal = () => {
                if (!portfolioModal.name.trim()) return;
                
                let newPortfolios;
                if (portfolioModal.mode === 'create') {
                    const newPort = { id: 'port_' + Date.now(), name: portfolioModal.name.trim(), books: [] };
                    newPortfolios = [...portfolios, newPort];
                    setActivePortfolioId(newPort.id);
                } else {
                    newPortfolios = portfolios.map(p => p.id === portfolioModal.id ? { ...p, name: portfolioModal.name.trim() } : p);
                }
                
                setPortfolios(newPortfolios);
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newPortfolios));
                setPortfolioModal({ isOpen: false, mode: 'create', name: '', id: null });
            };

            const deletePortfolio = () => {
                if (portfolios.length <= 1) return; 
                if (confirm(`Are you sure you want to delete the portfolio "${portfolioModal.name}" and all its properties?`)) {
                    const newPortfolios = portfolios.filter(p => p.id !== portfolioModal.id);
                    setPortfolios(newPortfolios);
                    setActivePortfolioId(newPortfolios[0].id);
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newPortfolios));
                    setPortfolioModal({ isOpen: false, mode: 'create', name: '', id: null });
                }
            };

            // Form & State
            const [signUpData, setSignUpData] = useState({ firstName: '', lastName: '', email: '', phone: '', password: '', confirmPassword: '', agreed: false, subscribe: false });
            const [authError, setAuthError] = useState('');
            const [inquiryData, setInquiryData] = useState({ firstName: '', lastName: '', email: '', phone: '', subject: '', message: '' });
            const [inquiryStatus, setInquiryStatus] = useState('idle');
            const [inquiryError, setInquiryError] = useState('');
            
            const [selectedPlan, setSelectedPlan] = useState(null);
            const [checkoutStatus, setCheckoutStatus] = useState('idle');

            const activeBook = useMemo(() => books.find(b => b.id === activeBookId) || DEMO_GUEST_BOOKS.find(b => b.id === activeBookId) || books[0] || null, [books, activeBookId]);

            const handlePolishWelcome = async () => {
                if (!editingBook.welcomeMessage || isAiLoading === 'welcome') return;
                setIsAiLoading('welcome');
                const res = await callGemini(`Luxury rewrite: "${editingBook.welcomeMessage}"`);
                setEditingBook({ ...editingBook, welcomeMessage: res.trim() });
                setIsAiLoading(null);
            };

            const handleSave = () => {
                const isNew = !activePort.books.find(b => b.id === editingBook.id);
                const updatedBooks = isNew ? [...activePort.books, editingBook] : activePort.books.map(b => b.id === editingBook.id ? editingBook : b);
                
                const updatedPortfolios = portfolios.map(p => p.id === activePortfolioId ? { ...p, books: updatedBooks } : p);
                setPortfolios(updatedPortfolios);
                
                try {
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(updatedPortfolios));
                } catch (e) {
                    console.error("Storage limit exceeded, cannot save to localStorage.", e);
                }
                
                if (isNew) setActiveBookId(editingBook.id);
                setView('dashboard');
            };

            const validateSignUp = () => {
                if (signUpData.password !== signUpData.confirmPassword) { setAuthError('Passwords do not match'); return false; }
                if (signUpData.password.length < 6) { setAuthError('Password must be at least 6 characters'); return false; }
                if (!signUpData.email.includes('@')) { setAuthError('Please enter a valid email address'); return false; }
                if (!signUpData.agreed) { setAuthError('Please agree to terms and conditions'); return false; }
                setAuthError(''); return true;
            };

            const handleSignUp = (e) => { e.preventDefault(); if (validateSignUp()) setView('dashboard'); };

            const handleInquirySubmit = (e) => {
                e.preventDefault();
                if (!inquiryData.email.includes('@')) { setInquiryError('Please enter a valid email address.'); return; }
                if (!inquiryData.subject) { setInquiryError('Please select a subject.'); return; }
                setInquiryError(''); setInquiryStatus('submitting');
                setTimeout(() => {
                    setInquiryStatus('success');
                    setInquiryData({ firstName: '', lastName: '', email: '', phone: '', subject: '', message: '' }); 
                }, 1200);
            };
            
            const handleCheckoutSubmit = (e) => {
                e.preventDefault();
                setCheckoutStatus('submitting');
                setTimeout(() => {
                    setCheckoutStatus('success');
                    setTimeout(() => {
                        setCheckoutStatus('idle');
                        setView('dashboard');
                    }, 1500);
                }, 1000);
            };

            const GoogleIcon = () => (
                <svg width="18" height="18" viewBox="0 0 18 18"><path d="M17.64 9.20455C17.64 8.56636 17.5827 7.95273 17.4764 7.36364H9V10.845H13.8436C13.635 11.97 13.0009 12.9232 12.0477 13.5614V15.8195H14.9564C16.6582 14.2527 17.64 11.9455 17.64 9.20455Z" fill="#4285F4"/><path d="M9 18C11.43 18 13.4673 17.1941 14.9564 15.8195L12.0477 13.5614C11.2418 14.1014 10.2109 14.4205 9 14.4205C6.65591 14.4205 4.67182 12.8373 3.96409 10.71H0.957273V13.0418C2.43818 15.9832 5.48182 18 9 18Z" fill="#34A853"/><path d="M3.96409 10.71C3.78409 10.17 3.68182 9.59318 3.68182 9C3.68182 8.40682 3.78409 7.83 3.96409 7.29V4.95818H0.957273C0.347727 6.17318 0 7.54773 0 9C0 10.4523 0.347727 11.8268 0.957273 13.0418L3.96409 10.71Z" fill="#FBBC05"/><path d="M9 3.57955C10.3214 3.57955 11.5077 4.03364 12.4405 4.92545L15.0218 2.34409C13.4632 0.891818 11.4259 0 9 0C5.48182 0 2.43818 2.01682 0.957273 4.95818L3.96409 7.29C4.67182 5.16273 6.65591 3.57955 9 3.57955Z" fill="#EA4335"/></svg>
            );

            const renderLanding = () => (
                <div className="min-h-screen bg-stone-50 flex flex-col font-sans overflow-y-auto no-scrollbar">
                    <header className="px-6 md:px-12 py-6 md:py-8 flex justify-between items-center bg-white/60 backdrop-blur-xl sticky top-0 z-[100] border-b border-stone-100">
                        <div className="flex items-center space-x-2 md:space-x-3 cursor-pointer" onClick={() => setLandingTab('login')}>
                            <BrandLogo />
                            <span className="text-3xl md:text-4xl font-serif italic tracking-tighter leading-none hidden sm:inline">guestbbook.</span>
                        </div>
                        <nav className="hidden md:flex space-x-8 lg:space-x-12 uppercase text-[10px] lg:text-[11px] font-black tracking-[0.4em] text-zinc-400">
                            {['demo', 'pricing', 'inquiry'].map(t => <button key={t} onClick={() => setLandingTab(t)} className={landingTab === t ? 'text-zinc-900' : 'hover:text-zinc-600 transition-colors'}>{t}</button>)}
                        </nav>
                        <button onClick={() => setLandingTab('signup')} className="bg-zinc-900 text-white px-6 md:px-10 py-3 md:py-4 rounded-full text-[10px] md:text-[11px] font-black uppercase tracking-widest shadow-2xl hover:scale-105 active:scale-95 transition-all truncate">Start Free Trial</button>
                    </header>
                    <main className="flex-1 flex items-center justify-center p-5 md:p-12 py-10 md:py-24 overflow-hidden w-full">
                        {landingTab === 'demo' ? (
                            <div className="max-w-7xl w-full flex flex-col space-y-10 md:space-y-16 animate-fade-up">
                                <div className="text-center space-y-3 md:space-y-4 px-2">
                                    <h1 className="text-4xl sm:text-5xl md:text-7xl font-serif italic text-zinc-900 tracking-tight">Interactive Demos</h1>
                                    <p className="text-zinc-500 text-base md:text-xl max-w-2xl mx-auto leading-relaxed">Experience the exact digital concierge your guests will use. Select a property to launch the preview.</p>
                                </div>
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 px-2 md:px-0">
                                    {DEMO_GUEST_BOOKS.map(demo => (
                                        <div key={demo.id} className="bg-white rounded-[2rem] md:rounded-[2.5rem] border border-stone-100 shadow-sm hover:shadow-2xl transition-all duration-500 overflow-hidden flex flex-col group p-2 min-w-0">
                                            <div className="h-48 sm:h-48 lg:h-56 overflow-hidden relative rounded-[1.5rem] md:rounded-[2rem]">
                                                <img src={demo.images[0].url} alt={demo.propertyName} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
                                                <div className="absolute inset-0 bg-black/5 group-hover:bg-transparent transition-colors duration-500"></div>
                                            </div>
                                            <div className="p-5 md:p-8 flex flex-col flex-1 text-left min-w-0">
                                                <h3 className="font-serif italic text-xl md:text-2xl text-zinc-900 mb-2 leading-tight truncate">{demo.propertyName}</h3>
                                                <p className="text-xs md:text-sm text-zinc-500 mb-6 md:mb-8 flex-1 leading-relaxed line-clamp-2 md:line-clamp-none">{demo.description}</p>
                                                <button onClick={() => { setActiveBookId(demo.id); setView('preview'); }} className="w-full bg-zinc-900 text-white hover:bg-zinc-800 py-3 md:py-4 rounded-xl md:rounded-[1.5rem] text-[9px] md:text-[10px] font-black uppercase tracking-widest transition-all active:scale-95 shadow-lg flex items-center justify-center space-x-2 mt-auto">
                                                    <span>Preview Demo</span>
                                                    <Icon name="arrow-right" size={14} />
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ) : landingTab === 'checkout' && selectedPlan ? (
                            <div className="bg-white rounded-[2rem] md:rounded-[3rem] shadow-2xl border border-stone-50 relative overflow-hidden auth-transition mx-2 md:mx-0 w-full max-w-4xl justify-self-center flex flex-col md:flex-row">
                                {checkoutStatus === 'success' ? (
                                    <div className="w-full p-12 text-center space-y-6 animate-fade-up my-auto py-24">
                                        <div className="w-20 h-20 bg-green-50 rounded-full flex items-center justify-center mx-auto">
                                            <Icon name="check-circle" size={40} className="text-green-500" />
                                        </div>
                                        <h3 className="text-3xl font-serif italic text-zinc-900">Payment Successful</h3>
                                        <p className="text-zinc-500">Your account has been upgraded to the {selectedPlan.l}.</p>
                                    </div>
                                ) : (
                                    <>
                                        {/* Summary Side */}
                                        <div className="bg-zinc-900 text-white p-8 md:p-12 md:w-[40%] flex flex-col justify-between relative overflow-hidden">
                                            <div className="absolute top-0 right-0 w-48 h-48 bg-white/5 rounded-full blur-2xl -mr-12 -mt-12 pointer-events-none"></div>
                                            <div className="relative z-10">
                                                <button onClick={() => setLandingTab('pricing')} className="text-[10px] font-black uppercase tracking-widest text-zinc-400 hover:text-white transition-colors mb-8 flex items-center"><Icon name="chevron-left" size={14} className="mr-1"/> Back</button>
                                                <h3 className="text-2xl md:text-3xl font-serif italic mb-2">Checkout</h3>
                                                <p className="text-zinc-400 text-xs leading-relaxed mb-8">You are about to elevate your guest experience.</p>
                                                
                                                <div className="pb-6 border-b border-white/10 mb-6">
                                                    <h4 className="font-bold text-xl">{selectedPlan.l}</h4>
                                                    <p className="text-zinc-400 text-sm mt-2 leading-relaxed">{selectedPlan.s}</p>
                                                </div>
                                                
                                                <div className="flex justify-between items-end">
                                                    <span className="text-zinc-400 text-xs font-black uppercase tracking-widest">Total Due</span>
                                                    <div className="text-right">
                                                        <span className="text-3xl md:text-4xl font-serif italic">{selectedPlan.p}</span>
                                                        <span className="text-[10px] text-zinc-500 uppercase tracking-widest ml-1">/ mo</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {/* Form Side */}
                                        <div className="p-8 md:p-12 md:w-[60%] flex flex-col justify-center bg-white relative z-10">
                                            <form className="space-y-5" onSubmit={handleCheckoutSubmit}>
                                                <div className="space-y-4">
                                                    <label className="text-[9px] font-black uppercase tracking-widest text-zinc-400 ml-2">Card Details</label>
                                                    <div className="space-y-3">
                                                        <div className="relative flex items-center">
                                                            <Icon name="credit-card" size={16} className="absolute left-4 text-zinc-400" />
                                                            <input placeholder="Card Number" required className="w-full bg-stone-50 pl-11 pr-4 py-3 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 transition-all font-mono min-w-0" />
                                                        </div>
                                                        <div className="grid grid-cols-2 gap-3">
                                                            <input placeholder="MM / YY" required className="w-full bg-stone-50 px-4 py-3 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 transition-all font-mono min-w-0 text-center" />
                                                            <input placeholder="CVC" required className="w-full bg-stone-50 px-4 py-3 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 transition-all font-mono min-w-0 text-center" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="space-y-3 pt-2">
                                                    <label className="text-[9px] font-black uppercase tracking-widest text-zinc-400 ml-2">Cardholder Name</label>
                                                    <input placeholder="e.g. Jane Doe" required className="w-full bg-stone-50 px-4 py-3 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 transition-all min-w-0" />
                                                </div>
                                                <button type="submit" disabled={checkoutStatus === 'submitting'} className="w-full bg-blue-600 text-white py-4 md:py-5 rounded-full md:rounded-[2rem] font-black uppercase text-[10px] md:text-xs tracking-widest shadow-xl md:shadow-2xl active:scale-95 transition-all mt-4 hover:bg-blue-700 disabled:opacity-70 truncate flex items-center justify-center space-x-2">
                                                    {checkoutStatus === 'submitting' ? (
                                                        <span>Processing...</span>
                                                    ) : (
                                                        <>
                                                            <Icon name="lock" size={14} />
                                                            <span>Pay {selectedPlan.p} Securely</span>
                                                        </>
                                                    )}
                                                </button>
                                            </form>
                                        </div>
                                    </>
                                )}
                            </div>
                        ) : (
                            <div className="max-w-7xl w-full grid md:grid-cols-2 gap-10 md:gap-24 items-center">
                                <div className="text-left space-y-8 md:space-y-10 animate-fade-up px-2 md:px-0">
                                    <h1 className="text-4xl sm:text-5xl md:text-7xl lg:text-8xl font-serif italic text-zinc-900 leading-[1.05] tracking-tight break-words">
                                        {landingTab === 'inquiry' ? "Let's connect." : "Luxury in every arrival."}
                                    </h1>
                                    <p className="text-zinc-500 text-base md:text-lg lg:text-xl max-w-md leading-relaxed text-left opacity-60">
                                        {landingTab === 'inquiry' 
                                            ? "Have questions about elevating your guest experience? Our dedicated team is here to assist." 
                                            : "The elite digital guidebook platform for five-star STR hosts. Elevate your brand today."}
                                    </p>
                                    
                                    {landingTab !== 'signup' && landingTab !== 'inquiry' && (
                                        <div className="flex items-center space-x-4 md:space-x-6 pt-4 md:pt-6 animate-fade-up">
                                            <div className="flex -space-x-2 md:-space-x-3 shrink-0">
                                                {[1,2,3].map(i => <div key={i} className="w-10 h-10 md:w-12 md:h-12 rounded-full border-4 border-stone-50 bg-stone-200"></div>)}
                                            </div>
                                            <p className="text-xs md:text-sm font-medium text-zinc-400 italic">Trusted by 500+ luxury hosts.</p>
                                        </div>
                                    )}
                                </div>
                                
                                {landingTab === 'pricing' ? (
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 animate-fade-up px-2 md:px-0">
                                        {[
                                            { l: 'Starter Plan', p: '$10', s: 'Includes: 1 Property' },
                                            { l: 'Growth Plan', p: '$20', s: 'Includes: Up to 3 Properties' },
                                            { l: 'Pro Plan', p: '$30', s: 'Includes: Up to 10 Properties' },
                                            { l: 'Enterprise Plan', p: '$50', s: 'Includes: Unlimited Properties', highlight: true }
                                        ].map(tier => (
                                            <div key={tier.l} className={`p-6 lg:p-8 rounded-[2rem] md:rounded-[2.5rem] border flex flex-col justify-between transition-all hover:shadow-2xl hover:-translate-y-1 ${tier.highlight ? 'bg-blue-600 text-white border-transparent shadow-lg' : 'bg-white border-stone-100 shadow-sm'}`}>
                                                <div>
                                                    <h4 className={`font-bold text-lg md:text-xl tracking-tight ${!tier.highlight && 'text-zinc-900'}`}>{tier.l}</h4>
                                                    <div className="mt-3 md:mt-4 flex items-end">
                                                        <span className="text-3xl md:text-4xl font-serif italic leading-none">{tier.p}</span>
                                                        <span className={`text-[9px] md:text-[10px] uppercase font-black tracking-widest ml-2 mb-1 ${tier.highlight ? 'text-blue-200' : 'text-zinc-400'}`}>/ month</span>
                                                    </div>
                                                </div>
                                                <div className={`mt-5 md:mt-6 pt-5 md:pt-6 border-t ${tier.highlight ? 'border-white/20' : 'border-stone-100'}`}>
                                                    <div className="flex items-center space-x-3">
                                                    <div className={`flex items-center justify-center w-5 h-5 md:w-6 md:h-6 rounded-full shrink-0 ${tier.highlight ? 'bg-white/20 text-white' : 'bg-stone-100 text-zinc-900'}`}>
                                                            <Icon name="check" size={12} />
                                                        </div>
                                                        <span className={`text-xs md:text-sm font-medium truncate ${tier.highlight ? 'text-blue-50' : 'text-zinc-700'}`}>{tier.s}</span>
                                                    </div>
                                                </div>
                                                <button onClick={() => { setSelectedPlan(tier); setLandingTab('checkout'); }} className={`mt-6 md:mt-8 py-3 md:py-4 rounded-full text-[9px] md:text-[10px] font-black uppercase tracking-widest border transition-all w-full ${tier.highlight ? 'bg-white text-blue-600 hover:bg-stone-50 border-transparent shadow-md' : 'bg-white border-stone-200 text-zinc-900 hover:bg-zinc-900 hover:text-white hover:border-zinc-900'}`}>Choose Plan</button>
                                            </div>
                                        ))}
                                    </div>
                                ) : landingTab === 'inquiry' ? (
                                    <div className="bg-white p-6 sm:p-8 md:p-12 rounded-[2.5rem] md:rounded-[4.5rem] shadow-2xl border border-stone-50 relative overflow-hidden auth-transition mx-2 md:mx-0 w-full max-w-md md:max-w-full justify-self-center md:justify-self-auto">
                                        <div className="animate-fade-up">
                                            {inquiryStatus === 'success' ? (
                                                <div className="text-center py-8 md:py-10 space-y-4 md:space-y-6">
                                                    <div className="w-16 h-16 md:w-20 md:h-20 bg-green-50 rounded-full flex items-center justify-center mx-auto">
                                                        <Icon name="check-circle" size={32} className="md:w-10 md:h-10 text-green-500" />
                                                    </div>
                                                    <h3 className="text-2xl md:text-3xl font-serif italic text-zinc-900">Message Sent</h3>
                                                    <p className="text-sm md:text-base text-zinc-500 leading-relaxed">Thank you for reaching out. We’ll respond within 24 hours.</p>
                                                    <button onClick={() => {setInquiryStatus('idle'); setLandingTab('login');}} className="mt-4 px-6 md:px-8 py-2.5 md:py-3 bg-stone-100 rounded-full text-[9px] md:text-[10px] font-black uppercase tracking-widest hover:bg-stone-200 transition-colors">Return</button>
                                                </div>
                                            ) : (
                                                <>
                                                    <div className="text-center mb-6 md:mb-8">
                                                        <h3 className="text-2xl md:text-3xl font-serif italic text-zinc-900">Contact Us</h3>
                                                        <p className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-300 mt-1 md:mt-2">Send us a direct message</p>
                                                    </div>
                                                    <form className="space-y-3 md:space-y-4" onSubmit={handleInquirySubmit}>
                                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4">
                                                            <input placeholder="First Name" required value={inquiryData.firstName} onChange={e => setInquiryData({...inquiryData, firstName: e.target.value})} className="w-full bg-stone-50 p-3 md:p-4 rounded-xl md:rounded-[1.5rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 min-w-0" />
                                                            <input placeholder="Last Name" required value={inquiryData.lastName} onChange={e => setInquiryData({...inquiryData, lastName: e.target.value})} className="w-full bg-stone-50 p-3 md:p-4 rounded-xl md:rounded-[1.5rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 min-w-0" />
                                                        </div>
                                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4">
                                                            <input type="email" placeholder="Email Address" required value={inquiryData.email} onChange={e => setInquiryData({...inquiryData, email: e.target.value})} className="w-full bg-stone-50 p-3 md:p-4 rounded-xl md:rounded-[1.5rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 min-w-0" />
                                                            <input type="tel" placeholder="Phone (Optional)" value={inquiryData.phone} onChange={e => setInquiryData({...inquiryData, phone: e.target.value})} className="w-full bg-stone-50 p-3 md:p-4 rounded-xl md:rounded-[1.5rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 min-w-0" />
                                                        </div>
                                                        <div className="relative">
                                                            <select required value={inquiryData.subject} onChange={e => setInquiryData({...inquiryData, subject: e.target.value})} className="w-full bg-stone-50 p-3 md:p-4 rounded-xl md:rounded-[1.5rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 appearance-none text-zinc-500 bg-transparent min-w-0">
                                                                <option value="" disabled>Subject / Reason for Inquiry</option>
                                                                <option value="sales">Sales & Pricing</option>
                                                                <option value="support">Technical Support</option>
                                                                <option value="partnership">Partnerships</option>
                                                                <option value="other">Other</option>
                                                            </select>
                                                            <Icon name="chevron-down" size={16} className="absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none" />
                                                        </div>
                                                        <textarea placeholder="Your message..." required rows="3" value={inquiryData.message} onChange={e => setInquiryData({...inquiryData, message: e.target.value})} className="w-full bg-stone-50 p-3 md:p-4 rounded-xl md:rounded-[1.5rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 resize-none min-w-0"></textarea>

                                                        {inquiryError && <p className="text-[9px] md:text-[10px] text-red-500 font-bold uppercase tracking-widest text-center">{inquiryError}</p>}

                                                        <button type="submit" disabled={inquiryStatus === 'submitting'} className="w-full bg-zinc-900 text-white p-4 md:p-5 rounded-full md:rounded-[2rem] font-black uppercase text-[10px] md:text-xs tracking-widest shadow-xl md:shadow-2xl active:scale-95 transition-all mt-2 hover:bg-zinc-800 disabled:opacity-70 truncate">
                                                            {inquiryStatus === 'submitting' ? 'Sending...' : 'Send Message'}
                                                        </button>
                                                    </form>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white p-6 sm:p-8 md:p-12 rounded-[2.5rem] md:rounded-[4.5rem] shadow-2xl border border-stone-50 relative overflow-hidden auth-transition mx-2 md:mx-0 w-full max-w-md md:max-w-full justify-self-center md:justify-self-auto">
                                        {landingTab === 'signup' ? (
                                            <div className="animate-fade-up">
                                                <div className="text-center mb-6 md:mb-10">
                                                    <h3 className="text-2xl md:text-3xl font-serif italic text-zinc-900">Create Account</h3>
                                                    <p className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-300 mt-1 md:mt-2">Start your 14-day free trial</p>
                                                </div>
                                                
                                                <form className="space-y-3 md:space-y-4" onSubmit={handleSignUp}>
                                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4">
                                                        <input placeholder="First Name" className="w-full bg-stone-50 p-4 md:p-5 rounded-xl md:rounded-[1.8rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 min-w-0" required value={signUpData.firstName} onChange={e => setSignUpData({...signUpData, firstName: e.target.value})} />
                                                        <input placeholder="Last Name" className="w-full bg-stone-50 p-4 md:p-5 rounded-xl md:rounded-[1.8rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 min-w-0" required value={signUpData.lastName} onChange={e => setSignUpData({...signUpData, lastName: e.target.value})} />
                                                    </div>
                                                    <input type="email" placeholder="Email Address" className="w-full bg-stone-50 p-4 md:p-5 rounded-xl md:rounded-[1.8rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 min-w-0" required value={signUpData.email} onChange={e => setSignUpData({...signUpData, email: e.target.value})} />
                                                    <input type="tel" placeholder="Phone Number (Optional)" className="w-full bg-stone-50 p-4 md:p-5 rounded-xl md:rounded-[1.8rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 min-w-0" value={signUpData.phone} onChange={e => setSignUpData({...signUpData, phone: e.target.value})} />
                                                    
                                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4">
                                                        <input type="password" placeholder="Password" className="w-full bg-stone-50 p-4 md:p-5 rounded-xl md:rounded-[1.8rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 min-w-0" required value={signUpData.password} onChange={e => setSignUpData({...signUpData, password: e.target.value})} />
                                                        <input type="password" placeholder="Confirm" className="w-full bg-stone-50 p-4 md:p-5 rounded-xl md:rounded-[1.8rem] text-xs md:text-sm outline-none focus:ring-1 ring-zinc-200 min-w-0" required value={signUpData.confirmPassword} onChange={e => setSignUpData({...signUpData, confirmPassword: e.target.value})} />
                                                    </div>

                                                    {authError && <p className="text-[9px] md:text-[10px] text-red-500 font-bold uppercase tracking-widest text-center">{authError}</p>}

                                                    <div className="space-y-2 md:space-y-3 pt-2">
                                                        <label className="flex items-center space-x-3 cursor-pointer group">
                                                            <input type="checkbox" checked={signUpData.agreed} onChange={e => setSignUpData({...signUpData, agreed: e.target.checked})} className="w-4 h-4 md:w-5 md:h-5 rounded-md md:rounded-lg border-stone-200 text-zinc-900 focus:ring-zinc-900 shrink-0" />
                                                            <span className="text-[10px] md:text-[11px] text-zinc-400 group-hover:text-zinc-600 transition-colors">I agree to the <span className="underline">Terms & Conditions</span></span>
                                                        </label>
                                                        <label className="flex items-center space-x-3 cursor-pointer group">
                                                            <input type="checkbox" checked={signUpData.subscribe} onChange={e => setSignUpData({...signUpData, subscribe: e.target.checked})} className="w-4 h-4 md:w-5 md:h-5 rounded-md md:rounded-lg border-stone-200 text-zinc-900 focus:ring-zinc-900 shrink-0" />
                                                            <span className="text-[10px] md:text-[11px] text-zinc-400 group-hover:text-zinc-600 transition-colors">Subscribe to email updates</span>
                                                        </label>
                                                    </div>

                                                    <button type="submit" className="w-full bg-zinc-900 text-white p-4 md:p-5 rounded-full md:rounded-[2rem] font-black uppercase text-[10px] md:text-xs tracking-widest shadow-xl md:shadow-2xl active:scale-95 transition-all mt-3 md:mt-4 hover:bg-zinc-800 truncate">Start a Free Trial</button>
                                                    
                                                    <p className="text-center text-[9px] md:text-[10px] text-zinc-400 uppercase font-black tracking-widest pt-3 md:pt-4">Already have an account? <button type="button" onClick={() => setLandingTab('login')} className="text-zinc-900 underline ml-1">Sign In</button></p>
                                                </form>
                                            </div>
                                        ) : (
                                            <div className="animate-fade-up">
                                                <div className="text-center mb-8 md:mb-10">
                                                    <Icon name="user" size={32} className="md:w-10 md:h-10 mx-auto text-zinc-200 mb-4 md:mb-6" />
                                                    <h3 className="text-2xl md:text-3xl font-serif italic text-zinc-900">Partner Login</h3>
                                                </div>
                                                <button onClick={() => setView('dashboard')} className="w-full bg-white border border-stone-200 py-4 md:py-5 rounded-full md:rounded-[2.5rem] flex items-center justify-center space-x-3 md:space-x-4 text-[10px] md:text-xs font-black uppercase tracking-[0.2em] mb-6 md:mb-10 hover:bg-stone-50 active:scale-95 transition-all shadow-sm truncate px-2"><GoogleIcon /><span className="truncate">Continue with Google</span></button>
                                                <div className="flex items-center space-x-3 md:space-x-4 mb-6 md:mb-8"><div className="flex-1 h-px bg-stone-100"></div><span className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-300 shrink-0">or use email</span><div className="flex-1 h-px bg-stone-100"></div></div>
                                                <form className="space-y-4 md:space-y-5" onSubmit={e => { e.preventDefault(); setView('dashboard'); }}>
                                                    <input type="email" placeholder="Email" className="w-full bg-stone-50 p-4 md:p-6 rounded-2xl md:rounded-[2.5rem] text-sm outline-none border border-transparent focus:border-zinc-200 min-w-0" required />
                                                    <input type="password" placeholder="Passphrase" className="w-full bg-stone-50 p-4 md:p-6 rounded-2xl md:rounded-[2.5rem] text-sm outline-none border border-transparent focus:border-zinc-200 min-w-0" required />
                                                    <button type="submit" className="w-full bg-zinc-900 text-white p-4 md:p-6 rounded-full md:rounded-[2.5rem] font-black uppercase text-[10px] md:text-xs tracking-widest shadow-xl md:shadow-2xl active:scale-95 transition-all hover:bg-zinc-800 truncate">Sign In</button>
                                                </form>
                                                <p className="text-center text-[9px] md:text-[10px] text-zinc-400 uppercase font-black tracking-widest pt-6 md:pt-8">New to Guestbbook? <button type="button" onClick={() => setLandingTab('signup')} className="text-zinc-900 underline ml-1">Create Account</button></p>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                </div>
            );

            const renderDashboard = () => (
                <div className="p-4 sm:p-6 md:p-10 max-w-7xl mx-auto h-full text-left overflow-y-auto no-scrollbar pb-32 md:pb-64">
                    
                    {/* Mobile Portfolio Selector */}
                    <div className="md:hidden w-full overflow-x-auto no-scrollbar flex space-x-2 pb-4 border-b border-stone-100 mb-6">
                        {portfolios.map(p => (
                            <button key={p.id} onClick={() => setActivePortfolioId(p.id)} className={`px-4 py-2 rounded-full text-[10px] font-black uppercase tracking-widest whitespace-nowrap transition-colors ${activePortfolioId === p.id ? 'bg-zinc-900 text-white' : 'bg-stone-50 text-zinc-400 hover:text-zinc-700'}`}>
                                {p.name}
                            </button>
                        ))}
                        <button onClick={openCreateModal} className="px-4 py-2 rounded-full text-[10px] font-black uppercase tracking-widest whitespace-nowrap bg-stone-50 text-zinc-500 hover:text-zinc-800 flex items-center space-x-1 transition-colors">
                            <Icon name="plus" size={12} /><span>New</span>
                        </button>
                    </div>

                    <div className="flex justify-between items-end mb-8 md:mb-16 animate-in">
                        <div className="min-w-0 pr-4">
                            <span className="text-zinc-400 text-[9px] md:text-[10px] font-black uppercase tracking-[0.4em] mb-1 md:mb-2 block truncate">Portfolio</span>
                            <div className="flex items-center space-x-3">
                                <h1 className="text-3xl sm:text-4xl md:text-5xl font-serif italic tracking-tight truncate">{activePort.name}</h1>
                                <button onClick={() => openRenameModal(activePort)} className="p-2 text-zinc-300 hover:text-zinc-900 transition-colors shrink-0 rounded-full hover:bg-white shadow-sm" title="Rename Portfolio">
                                    <Icon name="edit-3" size={20} className="md:w-6 md:h-6" />
                                </button>
                            </div>
                        </div>
                        <div className="flex items-center space-x-2 md:space-x-3 shrink-0">
                            <button onClick={() => { setView('landing'); setLandingTab('pricing'); }} className="md:hidden bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-full font-black text-[9px] uppercase tracking-widest transition-all active:scale-95 shadow-md flex items-center space-x-1.5">
                                <Icon name="zap" size={12} className="text-white" /> <span className="hidden sm:inline">Upgrade</span>
                            </button>
                            <button onClick={() => { setEditorTab('basics'); setEditingBook({ id: Date.now().toString(), propertyName: 'New Residence', address: '', images: [], welcomeMessage: 'Welcome!', checkInTime: '3:00 PM', checkOutTime: '10:00 AM', recommendations: [], houseRules: [], accentColor: '#18181b' }); setView('editor'); }} className="hidden md:flex bg-zinc-900 text-white px-6 md:px-10 py-4 md:py-5 rounded-full items-center space-x-2 md:space-x-3 shadow-xl hover:shadow-2xl hover:scale-105 active:scale-95 transition-all shrink-0">
                                <Icon name="plus" size={18} className="md:w-5 md:h-5" /><span className="font-bold text-xs md:text-sm uppercase tracking-tighter truncate">Add Property</span>
                            </button>
                        </div>
                    </div>
                    {books.length === 0 ? (
                        <div className="text-center py-16 md:py-20 bg-white rounded-[2rem] md:rounded-[3.5rem] border border-stone-100 shadow-sm px-4">
                            <Icon name="home" size={40} className="md:w-12 md:h-12 mx-auto text-zinc-200 mb-4 md:mb-6" />
                            <h3 className="text-xl md:text-2xl font-serif italic text-zinc-900 mb-2">No Properties Yet</h3>
                            <p className="text-sm md:text-base text-zinc-500 mb-6 md:mb-8">Start by adding your first luxury property guidebook.</p>
                            <button onClick={() => { setEditorTab('basics'); setEditingBook({ id: Date.now().toString(), propertyName: 'New Residence', address: '', images: [], welcomeMessage: 'Welcome!', checkInTime: '3:00 PM', checkOutTime: '10:00 AM', recommendations: [], houseRules: [], accentColor: '#18181b' }); setView('editor'); }} className="bg-zinc-900 text-white px-6 md:px-8 py-3 md:py-4 rounded-full font-bold text-[10px] md:text-xs uppercase tracking-widest shadow-xl hover:scale-105 transition-all">Add First Property</button>
                        </div>
                    ) : (
                        <div className="space-y-6 md:space-y-8 animate-in">
                            {books.map(b => (
                                <div key={b.id} className="bg-white rounded-[1.5rem] md:rounded-[3.5rem] overflow-hidden border border-stone-100 shadow-sm flex flex-col md:flex-row group transition-all duration-700 hover:shadow-xl md:hover:shadow-2xl">
                                    <div className="md:w-5/12 h-48 md:h-auto overflow-hidden bg-stone-100 shrink-0 relative">
                                        {b.images && b.images.length > 0 ? (
                                            <img src={b.images.find(i=>i.isCover)?.url || b.images[0].url} className="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110" />
                                        ) : (
                                            <div className="w-full h-full flex items-center justify-center bg-stone-200 text-zinc-400">
                                                <Icon name="image" size={32} className="md:w-12 md:h-12" />
                                            </div>
                                        )}
                                    </div>
                                    <div className="p-6 md:p-12 flex-1 flex flex-col justify-between min-w-0">
                                        <div>
                                            <div className="flex justify-between items-start mb-3 md:mb-4 gap-4">
                                                <h3 className="text-2xl sm:text-3xl md:text-4xl font-serif italic text-zinc-900 truncate">{b.propertyName}</h3>
                                                <div className="flex space-x-1.5 md:space-x-2 shrink-0">
                                                    <button onClick={() => {
                                                        if(confirm('Are you sure you want to delete this property?')) {
                                                            const updatedBooks = books.filter(book => book.id !== b.id);
                                                            const updatedPortfolios = portfolios.map(p => p.id === activePortfolioId ? { ...p, books: updatedBooks } : p);
                                                            setPortfolios(updatedPortfolios);
                                                            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(updatedPortfolios));
                                                        }
                                                    }} className="p-2 md:p-4 text-red-400 hover:bg-red-50 hover:text-red-600 rounded-full transition-all"><Icon name="trash-2" size={18} className="md:w-5 md:h-5" /></button>
                                                    <button onClick={() => { setEditorTab('basics'); setEditingBook({...b}); setView('editor'); }} className="p-2 md:p-4 bg-stone-50 rounded-full hover:bg-stone-100 active:scale-90 transition-all"><Icon name="edit-3" size={18} className="md:w-5 md:h-5" /></button>
                                                </div>
                                            </div>
                                            <div className="flex items-center text-zinc-400 text-[9px] md:text-[11px] font-black uppercase tracking-[0.2em] mb-4 md:mb-8 truncate">
                                                <Icon name="map-pin" size={12} className="md:w-3.5 md:h-3.5 mr-1.5 md:mr-2 shrink-0" />
                                                <span className="truncate">{b.address || 'Pending Location'}</span>
                                            </div>
                                            <p className="text-sm md:text-lg text-zinc-500 italic line-clamp-2 md:line-clamp-3 leading-relaxed">"{b.welcomeMessage}"</p>
                                        </div>
                                        <button onClick={() => { setActiveBookId(b.id); setView('preview'); }} className="flex items-center space-x-2 md:space-x-3 mt-6 md:mt-0 text-zinc-900 font-black text-[10px] md:text-xs uppercase tracking-[0.2em] hover:translate-x-2 transition-transform self-start"><span>Launch Preview</span><Icon name="chevron-right" size={16} className="md:w-5 md:h-5" /></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );

            const renderEditor = () => (
                <div className="flex flex-col h-full bg-white text-zinc-900">
                    <header className="px-4 sm:px-6 md:px-12 py-4 md:py-5 border-b border-stone-100 flex justify-between items-center z-50 bg-white relative">
                        <button onClick={() => setView('dashboard')} className="text-zinc-400 flex items-center space-x-1.5 md:space-x-2 text-[9px] md:text-[10px] font-black hover:text-zinc-900 transition-colors uppercase tracking-widest shrink-0"><Icon name="chevron-left" size={14} className="md:w-4 md:h-4" /><span className="hidden sm:inline">Back to Dashboard</span><span className="sm:hidden">Back</span></button>
                        <h2 className="text-base sm:text-lg md:text-xl font-serif italic truncate px-2 min-w-0 max-w-[150px] sm:max-w-xs md:max-w-md">{editingBook.propertyName || 'New Property'}</h2>
                        <button onClick={handleSave} className="bg-zinc-900 text-white px-5 sm:px-6 md:px-8 py-2 md:py-3 rounded-full text-[9px] md:text-[10px] font-black uppercase tracking-widest shadow-md md:shadow-xl hover:bg-zinc-800 active:scale-95 transition-all shrink-0">Save</button>
                    </header>
                    <div className="flex flex-1 overflow-hidden">
                        {/* Editor Left Pane */}
                        <div className="w-full lg:w-1/2 flex flex-col border-r border-stone-100 bg-white min-w-0">
                            
                            {/* Editor Tabs Navigation */}
                            <div className="px-4 md:px-10 pt-6 md:pt-8 pb-2 md:pb-4 border-b border-stone-50 lg:border-none">
                                <div className="flex space-x-2 overflow-x-auto no-scrollbar pb-2">
                                    {['basics', 'media', 'access', 'check-in', 'check-out', 'rules', 'host'].map(tab => (
                                        <button 
                                            key={tab} 
                                            onClick={() => setEditorTab(tab)} 
                                            className={`px-4 md:px-5 py-2 md:py-2.5 rounded-full text-[9px] md:text-[10px] font-black uppercase tracking-[0.2em] transition-all whitespace-nowrap shrink-0 ${editorTab === tab ? 'bg-zinc-900 text-white shadow-md' : 'bg-stone-50 text-zinc-400 hover:text-zinc-900 hover:bg-stone-100'}`}
                                        >
                                            {tab.replace('-', ' ')}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Tab Content Areas */}
                            <div className="flex-1 overflow-y-auto px-4 sm:px-6 md:px-10 py-6 md:py-8 pb-32 space-y-6 md:space-y-8 animate-in text-left">
                                
                                {editorTab === 'basics' && (
                                    <div className="space-y-6 md:space-y-8">
                                        <div className="space-y-3 md:space-y-4">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 ml-1 md:ml-2">Property Name</label>
                                            <input 
                                                placeholder="Enter property name..." 
                                                className="w-full bg-stone-50 text-zinc-900 px-4 py-3 md:px-5 md:py-4 rounded-xl md:rounded-[1.5rem] outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all font-serif italic text-lg md:text-xl min-w-0" 
                                                value={editingBook.propertyName} 
                                                onChange={e=>setEditingBook({...editingBook, propertyName:e.target.value})} 
                                            />
                                        </div>

                                        <div className="space-y-3 md:space-y-4">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 ml-1 md:ml-2">Location Address</label>
                                            <AddressAutocomplete 
                                                value={editingBook.address} 
                                                onChange={(newAddress) => setEditingBook({...editingBook, address: newAddress})} 
                                            />
                                        </div>

                                        <div className="space-y-3 md:space-y-4">
                                            <div className="flex justify-between items-center ml-1 md:ml-2">
                                                <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400">Welcome Message</label>
                                                <button onClick={handlePolishWelcome} className="text-[9px] md:text-[10px] font-bold text-indigo-500 hover:text-indigo-700 transition-all flex items-center space-x-1 truncate">
                                                    <Icon name="sparkles" size={12} className="shrink-0" />
                                                    <span className="truncate">{isAiLoading === 'welcome' ? 'Polishing...' : 'AI Polish'}</span>
                                                </button>
                                            </div>
                                            <textarea 
                                                placeholder="Write a warm welcome message for your guests..." 
                                                className="w-full bg-stone-50 text-zinc-900 px-4 py-3 md:px-5 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all h-28 md:h-32 resize-none leading-relaxed min-w-0" 
                                                value={editingBook.welcomeMessage} 
                                                onChange={e=>setEditingBook({...editingBook, welcomeMessage:e.target.value})} 
                                            />
                                        </div>

                                        <div className="space-y-3 md:space-y-4">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 ml-1 md:ml-2">Brand Accent Color</label>
                                            <div className="flex items-center space-x-3 md:space-x-4 bg-stone-50 p-3 md:p-4 rounded-xl md:rounded-[1.5rem] min-w-0">
                                                <input 
                                                    type="color" 
                                                    value={editingBook.accentColor} 
                                                    onChange={e=>setEditingBook({...editingBook, accentColor:e.target.value})} 
                                                    className="w-8 h-8 md:w-10 md:h-10 rounded-full cursor-pointer shadow-sm shrink-0"
                                                />
                                                <span className="text-xs md:text-sm font-medium text-zinc-600 uppercase truncate">{editingBook.accentColor}</span>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {editorTab === 'media' && (
                                    <div className="space-y-4 md:space-y-6">
                                        <div className="flex justify-between items-end mb-2 ml-1 md:ml-2">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400">Property Photos</label>
                                            <span className="text-[9px] md:text-[10px] text-zinc-400 font-medium bg-stone-100 px-2 py-1 rounded-md shrink-0">{editingBook.images?.length || 0} uploaded</span>
                                        </div>
                                        <ImageUploader 
                                            images={editingBook.images || []} 
                                            onChange={(newImages) => setEditingBook({...editingBook, images: newImages})} 
                                        />
                                    </div>
                                )}

                                {editorTab === 'access' && (
                                    <div className="space-y-6 md:space-y-8">
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div className="space-y-3 md:space-y-4">
                                                <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 ml-1 md:ml-2">Check-in Time</label>
                                                <input 
                                                    placeholder="e.g. 3:00 PM" 
                                                    className="w-full bg-stone-50 text-zinc-900 px-4 py-3 md:px-5 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all font-bold min-w-0" 
                                                    value={editingBook.checkInTime} 
                                                    onChange={e=>setEditingBook({...editingBook, checkInTime:e.target.value})} 
                                                />
                                            </div>
                                            <div className="space-y-3 md:space-y-4">
                                                <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 ml-1 md:ml-2">Check-out Time</label>
                                                <input 
                                                    placeholder="e.g. 10:00 AM" 
                                                    className="w-full bg-stone-50 text-zinc-900 px-4 py-3 md:px-5 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all font-bold min-w-0" 
                                                    value={editingBook.checkOutTime} 
                                                    onChange={e=>setEditingBook({...editingBook, checkOutTime:e.target.value})} 
                                                />
                                            </div>
                                        </div>

                                        <div className="space-y-3 md:space-y-4">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 ml-1 md:ml-2">Wi-Fi Network Name (SSID)</label>
                                            <div className="relative flex items-center">
                                                <Icon name="wifi" size={16} className="absolute left-4 md:left-5 text-zinc-400 md:w-[18px] md:h-[18px]" />
                                                <input 
                                                    placeholder="Network Name" 
                                                    className="w-full bg-stone-50 text-zinc-900 pl-10 pr-4 py-3 md:pl-12 md:pr-5 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all font-bold min-w-0" 
                                                    value={editingBook.wifiName} 
                                                    onChange={e=>setEditingBook({...editingBook, wifiName:e.target.value})} 
                                                />
                                            </div>
                                        </div>

                                        <div className="space-y-3 md:space-y-4">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 ml-1 md:ml-2">Wi-Fi Password</label>
                                            <div className="relative flex items-center">
                                                <Icon name="lock" size={16} className="absolute left-4 md:left-5 text-zinc-400 md:w-[18px] md:h-[18px]" />
                                                <input 
                                                    placeholder="Password" 
                                                    className="w-full bg-stone-50 text-zinc-900 pl-10 pr-4 py-3 md:pl-12 md:pr-5 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all font-mono min-w-0" 
                                                    value={editingBook.wifiPassword} 
                                                    onChange={e=>setEditingBook({...editingBook, wifiPassword:e.target.value})} 
                                                />
                                            </div>
                                        </div>

                                        <div className="space-y-3 md:space-y-4">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 ml-1 md:ml-2">Entry Door Code</label>
                                            <div className="relative flex items-center">
                                                <Icon name="key" size={16} className="absolute left-4 md:left-5 text-zinc-400 md:w-[18px] md:h-[18px]" />
                                                <input 
                                                    placeholder="e.g. 1234*" 
                                                    className="w-full bg-stone-50 text-zinc-900 pl-10 pr-4 py-3 md:pl-12 md:pr-5 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all font-bold min-w-0" 
                                                    value={editingBook.entryCode} 
                                                    onChange={e=>setEditingBook({...editingBook, entryCode:e.target.value})} 
                                                />
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {editorTab === 'check-in' && (
                                    <div className="space-y-4 md:space-y-6">
                                        <div className="mb-2 ml-1 md:ml-2">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400">Arrival Guide & Instructions</label>
                                            <p className="text-xs md:text-sm text-zinc-500 mt-1">Provide clear, step-by-step directions on how guests can access the property.</p>
                                        </div>
                                        <textarea 
                                            placeholder="E.g., Park in the driveway. The lockbox is located on the front door. Your access code is..." 
                                            className="w-full bg-stone-50 text-zinc-900 px-4 py-3 md:px-5 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all h-32 md:h-48 resize-none leading-relaxed min-w-0" 
                                            value={editingBook.checkInInstructions || ''} 
                                            onChange={e=>setEditingBook({...editingBook, checkInInstructions:e.target.value})} 
                                        />
                                    </div>
                                )}

                                {editorTab === 'check-out' && (
                                    <div className="space-y-4 md:space-y-6">
                                        <div className="mb-2 ml-1 md:ml-2">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400">Departure Checklist</label>
                                            <p className="text-xs md:text-sm text-zinc-500 mt-1">List specific tasks you would like your guests to complete before they leave.</p>
                                        </div>
                                        <ListEditor 
                                            items={editingBook.checkOutTasks || []} 
                                            onChange={(newTasks) => setEditingBook({...editingBook, checkOutTasks: newTasks})} 
                                            placeholder="E.g., Start the dishwasher..."
                                        />
                                    </div>
                                )}

                                {editorTab === 'rules' && (
                                    <div className="space-y-4 md:space-y-6">
                                        <div className="mb-2 ml-1 md:ml-2">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400">House Rules</label>
                                            <p className="text-xs md:text-sm text-zinc-500 mt-1">Add clear rules to ensure guests respect your property.</p>
                                        </div>
                                        <ListEditor 
                                            items={editingBook.houseRules || []} 
                                            onChange={(newRules) => setEditingBook({...editingBook, houseRules: newRules})} 
                                            placeholder="E.g., No parties or events..."
                                        />
                                    </div>
                                )}

                                {editorTab === 'host' && (
                                    <div className="space-y-6 md:space-y-8">
                                        <div className="space-y-3 md:space-y-4">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 ml-1 md:ml-2">Host Photo</label>
                                            <div className="flex items-center space-x-4 ml-1 md:ml-2">
                                                <div className="w-16 h-16 bg-stone-50 rounded-full flex items-center justify-center border-2 border-white shadow-sm overflow-hidden shrink-0 relative">
                                                    {editingBook.hostImage ? (
                                                        <img src={editingBook.hostImage} className="w-full h-full object-cover" />
                                                    ) : (
                                                        <Icon name="user" size={28} className="text-zinc-300 absolute mt-3" />
                                                    )}
                                                </div>
                                                <div className="flex flex-col space-y-2">
                                                    <input 
                                                        type="file" 
                                                        id="hostPhoto" 
                                                        accept="image/*" 
                                                        className="hidden" 
                                                        onChange={async (e) => {
                                                            if (e.target.files && e.target.files[0]) {
                                                                const dataUrl = await processImageFile(e.target.files[0]);
                                                                setEditingBook({...editingBook, hostImage: dataUrl});
                                                            }
                                                        }} 
                                                    />
                                                    <div className="flex space-x-2">
                                                        <label htmlFor="hostPhoto" className="px-4 py-2 bg-stone-50 border border-stone-200 hover:bg-stone-100 text-zinc-700 text-[9px] md:text-[10px] font-black uppercase tracking-widest rounded-xl cursor-pointer transition-colors text-center">
                                                            Upload Photo
                                                        </label>
                                                        {editingBook.hostImage && (
                                                            <button onClick={() => setEditingBook({...editingBook, hostImage: null})} className="px-4 py-2 bg-red-50 hover:bg-red-100 text-red-500 text-[9px] md:text-[10px] font-black uppercase tracking-widest rounded-xl cursor-pointer transition-colors text-center">
                                                                Remove
                                                            </button>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="space-y-3 md:space-y-4">
                                            <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 ml-1 md:ml-2">Host Name</label>
                                            <input 
                                                placeholder="e.g. Sarah & James" 
                                                className="w-full bg-stone-50 text-zinc-900 px-4 py-3 md:px-5 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all min-w-0" 
                                                value={editingBook.hostName || ''} 
                                                onChange={e=>setEditingBook({...editingBook, hostName:e.target.value})} 
                                            />
                                        </div>

                                        <div className="space-y-3 md:space-y-4">
                                            <div className="mb-2 ml-1 md:ml-2">
                                                <label className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400">About the Host</label>
                                                <p className="text-xs md:text-sm text-zinc-500 mt-1">Share a little bit about yourself or why you love hosting to add a personal touch.</p>
                                            </div>
                                            <textarea 
                                                placeholder="E.g., We are avid travelers who love sharing our home and helping guests discover the best local spots..." 
                                                className="w-full bg-stone-50 text-zinc-900 px-4 py-3 md:px-5 md:py-4 rounded-xl md:rounded-[1.5rem] text-sm md:text-base outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all h-32 md:h-48 resize-none leading-relaxed min-w-0" 
                                                value={editingBook.hostBio || ''} 
                                                onChange={e=>setEditingBook({...editingBook, hostBio:e.target.value})} 
                                            />
                                        </div>
                                    </div>
                                )}

                            </div>
                        </div>
                        
                        {/* Editor Right Pane (Preview) */}
                        <div className="hidden lg:flex flex-1 items-center justify-center bg-stone-100 p-10 relative">
                            <div className="absolute top-6 left-6 flex items-center space-x-2">
                                <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                <span className="text-[10px] font-black uppercase tracking-widest text-zinc-400">Live Preview</span>
                            </div>
                            <div className="w-[375px] h-[800px] bg-white rounded-[3.5rem] shadow-2xl border-[10px] border-zinc-900 overflow-hidden relative scale-95 transition-transform">
                                <MobileContent book={editingBook} />
                                <div className="absolute top-0 inset-x-0 h-7 flex justify-center pt-2 z-[100] bg-white rounded-b-3xl max-w-[140px] mx-auto">
                                    <div className="w-16 h-1.5 bg-zinc-200 rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="h-screen w-screen bg-white relative">
                    {/* Portfolio Modal */}
                    {portfolioModal.isOpen && (
                        <div className="fixed inset-0 z-[200] flex items-center justify-center bg-black/40 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-[2.5rem] p-6 sm:p-8 w-full max-w-sm shadow-2xl animate-fade-up">
                                <h3 className="text-2xl font-serif italic text-zinc-900 mb-2">
                                    {portfolioModal.mode === 'create' ? 'New Portfolio' : 'Rename Portfolio'}
                                </h3>
                                <p className="text-xs text-zinc-500 mb-6">
                                    {portfolioModal.mode === 'create' ? 'Create a new collection for your properties.' : 'Change the name of your portfolio.'}
                                </p>
                                <input 
                                    autoFocus
                                    value={portfolioModal.name} 
                                    onChange={e => setPortfolioModal({...portfolioModal, name: e.target.value})} 
                                    className="w-full bg-stone-50 px-5 py-4 rounded-[1.5rem] text-sm outline-none border border-transparent focus:border-zinc-200 focus:bg-white transition-all mb-6"
                                    placeholder="Portfolio Name"
                                    onKeyDown={e => { if (e.key === 'Enter') submitPortfolioModal(); }}
                                />
                                <div className="flex justify-between items-center">
                                    {portfolioModal.mode === 'rename' && portfolios.length > 1 ? (
                                        <button onClick={deletePortfolio} className="p-3 text-red-400 hover:bg-red-50 hover:text-red-600 rounded-xl transition-colors" title="Delete Portfolio">
                                            <Icon name="trash-2" size={18} />
                                        </button>
                                    ) : <div></div>}
                                    <div className="flex space-x-2">
                                        <button onClick={() => setPortfolioModal({...portfolioModal, isOpen: false})} className="px-5 py-3 rounded-full text-[10px] font-black uppercase tracking-widest text-zinc-400 hover:text-zinc-900 transition-colors">Cancel</button>
                                        <button onClick={submitPortfolioModal} disabled={!portfolioModal.name.trim()} className="bg-zinc-900 text-white px-6 py-3 rounded-full text-[10px] font-black uppercase tracking-widest shadow-xl hover:bg-zinc-800 disabled:opacity-50 transition-all">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'landing' ? renderLanding() : view === 'dashboard' ? (
                        <div className="flex h-full animate-in flex-col md:flex-row">
                            <aside className="w-full md:w-80 border-b md:border-b-0 md:border-r border-stone-100 p-4 sm:p-6 md:p-12 flex flex-row md:flex-col space-y-0 md:space-y-12 shrink-0 bg-white text-left items-center md:items-stretch justify-between md:justify-start">
                                <div className="flex items-center space-x-2 md:space-x-3 cursor-pointer min-w-0" onClick={() => setView('landing')}>
                                    <BrandLogo />
                                    <span className="text-2xl md:text-3xl font-serif italic hidden md:block truncate">guestbbook.</span>
                                </div>
                                <nav className="hidden md:flex flex-1 flex-col space-y-1 text-left">
                                    <p className="text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400 mb-2 px-4">Portfolios</p>
                                    <div className="space-y-1 max-h-[40vh] overflow-y-auto no-scrollbar">
                                        {portfolios.map(p => (
                                            <SidebarItem key={p.id} iconName={activePortfolioId === p.id ? 'folder-open' : 'folder'} label={p.name} active={activePortfolioId === p.id && view === 'dashboard'} onClick={() => { setActivePortfolioId(p.id); setView('dashboard'); }} />
                                        ))}
                                    </div>
                                    <button onClick={openCreateModal} className="w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-zinc-500 hover:text-zinc-900 hover:bg-zinc-50 transition-colors mt-2">
                                        <Icon name="plus" size={18} />
                                        <span className="font-semibold text-sm">New Portfolio</span>
                                    </button>
                                </nav>
                                
                                {/* Mobile Actions */}
                                <div className="md:hidden flex items-center space-x-2 shrink-0">
                                    <button onClick={() => { setView('landing'); setLandingTab('pricing'); }} className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-full font-black text-[9px] uppercase tracking-widest transition-all active:scale-95 shadow-md flex items-center space-x-1.5">
                                        <Icon name="zap" size={12} className="text-white" /> <span className="hidden sm:inline">Upgrade</span>
                                    </button>
                                    <button onClick={() => setView('landing')} className="p-2.5 bg-stone-50 rounded-full text-zinc-400 hover:text-zinc-900 transition-all shadow-sm" title="Sign Out">
                                        <Icon name="log-out" size={14}/>
                                    </button>
                                </div>

                                {/* Desktop Actions */}
                                <div className="hidden md:flex flex-col space-y-3 mt-auto w-full">
                                    <button onClick={() => { setView('landing'); setLandingTab('pricing'); }} className="flex items-center justify-between p-5 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl hover:bg-blue-700 hover:-translate-y-1 active:scale-95 transition-all group">
                                        <span className="truncate">Upgrade Plan</span> 
                                        <Icon name="zap" size={14} className="text-white group-hover:scale-110 transition-transform shrink-0"/>
                                    </button>
                                    <button onClick={() => setView('landing')} className="flex items-center justify-between p-5 bg-stone-50 rounded-2xl text-[10px] font-black uppercase tracking-widest text-zinc-400 hover:text-zinc-900 hover:bg-stone-100 transition-all">
                                        Sign Out <Icon name="log-out" size={14} className="shrink-0"/>
                                    </button>
                                </div>
                            </aside>
                            <main className="flex-1 overflow-hidden bg-stone-50/10 min-w-0">{renderDashboard()}</main>
                            <button onClick={() => { setEditorTab('basics'); setEditingBook({ id: Date.now().toString(), propertyName: 'New Residence', address: '', images: [], welcomeMessage: 'Welcome!', checkInTime: '3:00 PM', checkOutTime: '10:00 AM', recommendations: [], houseRules: [], accentColor: '#18181b' }); setView('editor'); }} className="md:hidden fixed bottom-6 right-6 w-14 h-14 bg-zinc-900 text-white rounded-full flex items-center justify-center shadow-2xl z-50"><Icon name="plus" size={24} /></button>
                        </div>
                    ) : view === 'editor' ? renderEditor() : view === 'preview' ? (
                        <div className="min-h-screen bg-stone-100 flex flex-col items-center animate-fade-up">
                            <header className="w-full bg-white/90 backdrop-blur-2xl border-b border-stone-100 px-4 sm:px-6 md:px-12 py-3 md:py-4 flex justify-between items-center sticky top-0 z-[100] shadow-sm">
                                <button onClick={() => setView(String(activeBookId).startsWith('demo') ? 'landing' : 'dashboard')} className="text-[9px] md:text-[11px] font-black uppercase tracking-[0.2em] md:tracking-[0.3em] text-zinc-400 hover:text-zinc-900 transition-colors flex items-center shrink-0"><Icon name="chevron-left" size={14} className="mr-1 md:w-4 md:h-4" /><span className="hidden sm:inline">Exit Preview</span><span className="sm:hidden">Exit</span></button>
                                <div className="bg-stone-100 p-1 md:p-1.5 rounded-full flex items-center space-x-1 md:space-x-2 shadow-inner shrink-0">
                                    <button onClick={() => setPreviewMode('mobile')} className={`px-4 md:px-8 py-1.5 md:py-2.5 rounded-full text-[9px] md:text-[10px] font-black uppercase tracking-widest transition-all ${previewMode === 'mobile' ? 'bg-zinc-900 text-white shadow-lg' : 'text-zinc-400 hover:text-zinc-600'}`}>Mobile</button>
                                    <button onClick={() => setPreviewMode('web')} className={`px-4 md:px-8 py-1.5 md:py-2.5 rounded-full text-[9px] md:text-[10px] font-black uppercase tracking-widest transition-all ${previewMode === 'web' ? 'bg-zinc-900 text-white shadow-lg' : 'text-zinc-400 hover:text-zinc-600'}`}>Web</button>
                                </div>
                                <div className="flex items-center space-x-2 md:space-x-3 text-left shrink-0"><span className="text-[9px] md:text-[10px] font-black uppercase tracking-widest text-zinc-400 hidden sm:inline">Live</span><div className="w-2 h-2 md:w-2.5 md:h-2.5 rounded-full bg-green-500 shadow-xl animate-pulse"></div></div>
                            </header>
                            <div className={`transition-all duration-1000 ease-in-out bg-stone-50 shadow-2xl relative overflow-hidden flex-1 w-full ${previewMode === 'mobile' ? 'w-[95%] sm:w-full sm:max-w-md min-h-[80vh] my-4 md:my-12 rounded-[2.5rem] md:rounded-[3.5rem] border-[6px] md:border-[10px] border-zinc-900' : 'min-h-screen'}`}>
                                <MobileContent book={activeBook} />
                            </div>
                        </div>
                    ) : null}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>